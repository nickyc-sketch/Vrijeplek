<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard ‚Äî Vrijeplek</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=ocean3">

  <style>
    :root{
      --o1:#1a66ff; --o2:#0056ff; --ink:#0a2a4a; --muted:#3a4b6a;
      --glass-b: rgba(26,102,255,.18); --glass: rgba(255,255,255,.7);
      --line: rgba(26,102,255,.25); --danger:#e23b3b; --ok:#0fa958;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Poppins",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--ink);
      background:
        radial-gradient(120% 140% at 0% 0%, #003b84 0, transparent 60%),
        radial-gradient(120% 140% at 100% 0%, #00a0ff 0, transparent 55%),
        radial-gradient(160% 160% at 50% 120%, #021428 0, #020617 55%);
      background-attachment:fixed;
    }

    .site{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    .site-header{
      position:sticky;
      top:0;
      z-index:40;
      backdrop-filter:blur(26px);
      background:linear-gradient(180deg,rgba(2,6,23,.92),rgba(2,6,23,.7),rgba(2,6,23,0));
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .header-inner{
      max-width:1120px;
      margin:0 auto;
      padding:.9rem 1.5rem .8rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1.25rem;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.6rem;
      text-decoration:none;
    }
    .header-left{
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    .btn-home{
      border-radius:999px;
      padding:.28rem .7rem;
      font-size:.78rem;
      border:1px solid rgba(148,163,184,.7);
      background:rgba(15,23,42,.6);
      color:rgba(226,232,240,.9);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      backdrop-filter:blur(10px);
    }
    .btn-home:hover{
      background:rgba(15,23,42,.9);
      border-color:rgba(191,219,254,.9);
      transform:translateY(-1px);
    }
    .brand-mark{
      width:32px; height:32px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%, #fff 0, #b3e0ff 18%, transparent 40%),
                 radial-gradient(circle at 80% 80%, #0f5bff 0, #001d5c 55%);
      box-shadow:0 0 0 1px rgba(255,255,255,.1),0 10px 30px rgba(0,0,0,.4);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.1rem;
      font-weight:700;
      color:#fff;
    }
    .brand-wordmark{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .brand-wordmark span:first-child{
      font-weight:700;
      letter-spacing:.02em;
      font-size:1.05rem;
      color:#f9fafb;
    }
    .brand-wordmark span:last-child{
      font-size:.7rem;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:rgba(226,232,240,.7);
    }
    .header-actions{
      display:flex;
      align-items:center;
      gap:.6rem;
    }
    .chip-pill{
      font-size:.72rem;
      padding:.2rem .6rem;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.5);
      color:rgba(226,232,240,.7);
      display:flex;
      align-items:center;
      gap:.35rem;
    }
    .chip-dot{
      width:8px; height:8px;
      border-radius:999px;
      background:radial-gradient(circle at 50% 50%, #4ade80 0,#22c55e 50%,#166534 100%);
      box-shadow:0 0 0 4px rgba(34,197,94,.2);
    }
    .btn-head{
      border-radius:999px;
      padding:.4rem .9rem;
      font-size:.82rem;
      border:1px solid rgba(129,140,248,.7);
      background:rgba(15,23,42,.4);
      color:#e5edff;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      backdrop-filter:blur(10px);
    }
    .btn-head-primary{
      border:none;
      background:linear-gradient(135deg,var(--o1),var(--o2));
      color:#fff;
      box-shadow:0 10px 30px rgba(15,118,255,.4);
    }

    .site-main{
      flex:1;
      display:flex;
      justify-content:center;
      padding:1.2rem 1.2rem 2.2rem;
    }
    .dash-shell{
      width:100%;
      max-width:1120px;
    }

    .dash-layout{
      display:grid;
      grid-template-columns:minmax(220px,260px) minmax(0,1fr);
      gap:1.5rem;
      align-items:flex-start;
    }

    .dash-tabs{
      background:rgba(15,23,42,.8);
      border-radius:1.25rem;
      padding:.75rem;
      border:1px solid rgba(148,163,184,.3);
      box-shadow:0 18px 50px rgba(15,23,42,.7);
      backdrop-filter:blur(22px);
    }
    .dash-tab{
      width:100%;
      text-align:left;
      border:none;
      background:transparent;
      padding:.65rem .9rem;
      border-radius:.9rem;
      display:flex;
      flex-direction:column;
      gap:.1rem;
      cursor:pointer;
      transition:.18s ease;
      color:rgba(226,232,240,.8);
      position:relative;
    }
    .dash-tab + .dash-tab{margin-top:.25rem;}
    .dash-tab-icon{font-size:1.05rem;}
    .dash-tab-label{font-weight:600; font-size:.9rem;}
    .dash-tab-sub{font-size:.75rem; opacity:.7;}
    .dash-tab::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      border:1px solid transparent;
      transition:.18s ease;
      pointer-events:none;
      z-index:-1;
    }
    .dash-tab:hover{
      background:rgba(15,118,255,.08);
    }
    .dash-tab.is-active{
      background:radial-gradient(circle at 0 0,rgba(59,130,246,.45),rgba(30,64,175,.9));
      color:#f9fafb;
      box-shadow:0 14px 40px rgba(15,23,42,.9);
    }
    .dash-tab.is-active::after{
      border-color:rgba(191,219,254,.9);
    }

    .dash-panels{display:block;}
    .dash-panel{display:none;}
    .dash-panel.is-visible{display:block;}

    .panel-head{margin-bottom:1rem;}
    .panel-head h1{
      font-size:1.4rem;
      color:#e5edff;
      margin:0 0 .25rem;
    }
    .panel-intro{
      margin:0;
      font-size:.88rem;
      color:rgba(191,219,254,.8);
    }

    .card{
      background:rgba(15,23,42,.84);
      border-radius:1.25rem;
      padding:1.25rem 1.4rem 1.35rem;
      border:1px solid rgba(148,163,184,.35);
      box-shadow:0 22px 60px rgba(15,23,42,.9);
      color:#e5e7eb;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(circle at 0 0,rgba(59,130,246,.12),transparent 55%),
        radial-gradient(circle at 100% 0,rgba(56,189,248,.12),transparent 50%);
      opacity:.7;
      pointer-events:none;
    }
    .card > *{position:relative; z-index:1;}
    .card-soft{
      background:linear-gradient(135deg,rgba(15,23,42,.9),rgba(15,23,42,.92));
    }
    .card-glass{
      background:linear-gradient(135deg,rgba(37,99,235,.96),rgba(8,47,107,.96));
      border-color:rgba(191,219,254,.55);
      color:#f9fafb;
    }

    .card-title{
      font-size:1.1rem;
      margin:0 0 .3rem;
    }
    .card-subtitle{
      margin:0 0 1rem;
      font-size:.85rem;
      color:rgba(226,232,240,.85);
    }
    .card-header-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:1rem;
      flex-wrap:wrap;
    }
    .card-divider{
      border:none;
      border-top:1px solid rgba(148,163,184,.4);
      margin:1.2rem 0 1rem;
    }

    .badge-warning{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size:.78rem;
      padding:.2rem .6rem;
      border-radius:999px;
      background:rgba(250,204,21,.15);
      border:1px solid rgba(250,204,21,.6);
      color:#fef3c7;
      margin-bottom:.75rem;
    }
    .badge-warning::before{
      content:"!";
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:14px; height:14px;
      border-radius:999px;
      background:#facc15;
      color:#1f2937;
      font-size:.7rem;
      font-weight:800;
    }

    .cards-grid{
      display:grid;
      grid-template-columns:minmax(0,1.05fr) minmax(0,1.25fr);
      gap:1.25rem;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:.28rem;
      margin-bottom:.8rem;
    }
    .field label{
      font-size:.84rem;
      font-weight:500;
      color:rgba(226,232,240,.9);
    }
    .field input,
    .field textarea{
      border-radius:.75rem;
      border:1px solid rgba(148,163,184,.6);
      background:rgba(15,23,42,.85);
      color:#e5e7eb;
      padding:.5rem .7rem;
      font-size:.9rem;
      outline:none;
      transition:.16s ease;
    }
    .field input::placeholder,
    .field textarea::placeholder{
      color:rgba(148,163,184,.8);
      font-size:.84rem;
    }
    .field input:focus,
    .field textarea:focus{
      border-color:rgba(59,130,246,.9);
      box-shadow:0 0 0 1px rgba(59,130,246,.6);
      background:rgba(15,23,42,.96);
    }

    .field-group{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:.75rem;
    }

    .slot-form .slot-row{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:.75rem;
      align-items:flex-end;
    }
    .slot-form .slot-row input[type="time"],
    .slot-form .slot-row input[type="number"]{
      height:44px;
      line-height:44px;
    }

    .helper{
      font-size:.78rem;
      color:rgba(148,163,184,.95);
      line-height:1.5;
    }
    .example{
      font-size:.8rem;
      color:rgba(191,219,254,.9);
      margin-top:.35rem;
    }

    .input-with-prefix{
      display:flex;
      align-items:center;
      gap:.35rem;
    }
    .input-with-prefix span{
      padding:.35rem .6rem;
      border-radius:.75rem;
      border:1px solid rgba(148,163,184,.7);
      background:rgba(15,23,42,.95);
      font-size:.8rem;
      color:rgba(226,232,240,.9);
    }

    .form-actions{
      display:flex;
      justify-content:flex-end;
      gap:.5rem;
      margin-top:.6rem;
    }

    .switch{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      cursor:pointer;
      user-select:none;
    }
    .switch input{display:none;}
    .switch-slider{
      width:38px;
      height:20px;
      border-radius:18px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.7);
      position:relative;
      transition:.18s ease;
    }
    .switch-slider::after{
      content:"";
      position:absolute;
      width:16px; height:16px;
      border-radius:999px;
      background:#e5e7eb;
      top:1px; left:1px;
      transition:.18s ease;
      box-shadow:0 2px 6px rgba(15,23,42,.6);
    }
    .switch input:checked + .switch-slider{
      background:linear-gradient(135deg,var(--o1),var(--o2));
      border-color:rgba(191,219,254,.9);
    }
    .switch input:checked + .switch-slider::after{
      transform:translateX(16px);
      background:#f9fafb;
    }
    .switch-label{
      font-size:.85rem;
      color:rgba(226,232,240,.9);
    }

    .deposit-settings{
      margin-top:.75rem;
      padding:.85rem .95rem;
      border-radius:.9rem;
      border:1px dashed rgba(148,163,184,.7);
      background:rgba(15,23,42,.9);
    }
    .deposit-settings.is-disabled{
      opacity:.45;
      pointer-events:none;
    }

    .btn,
    .btn-primary,
    .btn-ghost,
    .btn-pill{
      border-radius:999px;
      padding:.48rem 1.05rem;
      font-size:.86rem;
      border:1px solid transparent;
      cursor:pointer;
      font-weight:500;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      background:transparent;
    }
    .btn-primary{
      background:linear-gradient(135deg,var(--o1),var(--o2));
      color:#f9fafb;
      border:none;
      box-shadow:0 14px 40px rgba(37,99,235,.55);
    }
    .btn-primary:hover{
      filter:brightness(1.05);
      transform:translateY(-1px);
    }
    .btn-ghost{
      background:rgba(15,23,42,.2);
      border-color:rgba(148,163,184,.7);
      color:rgba(226,232,240,.9);
    }
    .btn-ghost:hover{
      background:rgba(15,23,42,.4);
    }
    .btn-pill{
      background:rgba(15,23,42,.1);
      border-color:rgba(191,219,254,.7);
      color:#e0f2fe;
      font-size:.78rem;
      padding:.3rem .8rem;
    }
    .btn-small{
      padding:.25rem .7rem;
      font-size:.78rem;
    }
    .btn-danger{
      border-color:rgba(239,68,68,.75);
      color:#fecaca;
    }
    .btn-danger:hover{
      background:rgba(127,29,29,.75);
    }

    .empty-state{
      border-radius:.9rem;
      background:rgba(15,23,42,.85);
      border:1px dashed rgba(148,163,184,.7);
      padding:.85rem 1rem;
      font-size:.86rem;
      color:rgba(226,232,240,.95);
    }
    .empty-state strong{font-weight:600;}

    .calendar-controls{
      display:flex;
      align-items:center;
      gap:.45rem;
      font-size:.82rem;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .calendar-controls .btn-ghost,
    .calendar-controls .btn-pill{
      padding:.3rem .7rem;
      font-size:.78rem;
    }
    .calendar-month{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      min-width:auto;
    }
    .calendar-month span:first-child{
      font-weight:600;
    }
    .calendar-month span:last-child{
      font-size:.75rem;
      opacity:.85;
    }

    .calendar-shell{
      margin-top:.85rem;
      padding:.75rem .8rem .9rem;
      border-radius:1rem;
      background:radial-gradient(circle at 0 0,rgba(15,23,42,.18),transparent 60%);
      box-shadow:inset 0 0 0 1px rgba(148,163,184,.4);
    }
    .calendar-days-row{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      font-size:.78rem;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:rgba(226,232,240,.8);
      margin-bottom:.3rem;
    }
    .calendar-days-row span{
      text-align:center;
      padding-bottom:.15rem;
    }
    .calendar-grid{
      display:grid;
      grid-template-columns:repeat(7,minmax(0,1fr));
      gap:.18rem;
    }
    .calendar-day{
      position:relative;
      aspect-ratio:1/1;
      border-radius:.85rem;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.8rem;
      cursor:pointer;
      background:rgba(15,23,42,.92);
      border:1px solid rgba(148,163,184,.55);
      color:#e5e7eb;
      transition:.14s ease;
      overflow:hidden;
    }
    .calendar-day::after{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 10% 0,rgba(248,250,252,.22),transparent 55%);
      opacity:0;
      transition:.2s ease;
    }
    .calendar-day:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 30px rgba(15,23,42,.95);
      border-color:rgba(191,219,254,.9);
    }
    .calendar-day:hover::after{opacity:1;}
    .calendar-day.is-today{
      border-color:#fbbf24;
      box-shadow:0 0 0 1px rgba(251,191,36,.6);
    }
    .calendar-day.is-selected{
      background:linear-gradient(135deg,#f9fafb,#93c5fd);
      color:#0f172a;
      font-weight:700;
      box-shadow:0 14px 40px rgba(15,23,42,1);
    }

    .slot-list h3{
      margin:0 0 .25rem;
      font-size:.95rem;
      color:#e5e7eb;
    }

    .slot-item{
      border-radius:.9rem;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.7);
      padding:.7rem .9rem;
      margin-bottom:.6rem;
    }
    .slot-item.is-booked{
      border-style:dashed;
      border-color:rgba(234,179,8,.9);
    }
    .slot-item-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:.75rem;
    }
    .slot-item-title{
      font-weight:600;
      font-size:.9rem;
    }
    .slot-item-desc{
      font-size:.83rem;
      margin-top:.15rem;
      color:rgba(226,232,240,.95);
    }
    .slot-meta{
      font-size:.76rem;
      color:rgba(148,163,184,.95);
      margin-top:.25rem;
    }
    .slot-actions{
      display:flex;
      flex-wrap:wrap;
      gap:.4rem;
      margin-top:.5rem;
    }

    .settings-group{
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.5);
      padding:1rem 1rem .9rem;
      margin-bottom:1rem;
      background:rgba(15,23,42,.95);
    }
    .settings-group-muted{
      background:rgba(15,23,42,.85);
      border-style:dashed;
    }
    .settings-group legend{
      padding:0 .3rem;
      font-size:.86rem;
      font-weight:600;
      color:rgba(191,219,254,.95);
      text-transform:uppercase;
      letter-spacing:.12em;
      margin-bottom:.4rem;
    }

    .site-footer{
      padding:1rem 1.5rem 1.4rem;
      border-top:1px solid rgba(15,23,42,.8);
      background:radial-gradient(circle at 50% -50%,rgba(59,130,246,.35),transparent 60%),
                 rgba(2,6,23,.96);
    }
    .footer-inner{
      max-width:1120px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.75rem;
      color:rgba(148,163,184,.9);
      font-size:.78rem;
    }
    .footer-inner a{
      color:rgba(191,219,254,.95);
      text-decoration:none;
    }

    .toast{
      position:fixed;
      right:1.4rem;
      bottom:1.4rem;
      max-width:280px;
      padding:.7rem .9rem;
      border-radius:1rem;
      font-size:.82rem;
      display:flex;
      align-items:flex-start;
      gap:.5rem;
      border:1px solid transparent;
      box-shadow:0 18px 40px rgba(15,23,42,.9);
      background:rgba(15,23,42,.95);
      color:#e5e7eb;
      opacity:0;
      pointer-events:none;
      transform:translateY(10px);
      transition:opacity .18s ease, transform .18s ease;
      z-index:80;
    }
    .toast.is-visible{
      opacity:1;
      pointer-events:auto;
      transform:translateY(0);
    }
    .toast-icon{
      width:20px;
      height:20px;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:.9rem;
      font-weight:700;
      flex-shrink:0;
    }
    .toast-success{
      border-color:rgba(34,197,94,.8);
      background:linear-gradient(135deg,rgba(22,163,74,.96),rgba(15,118,110,.96));
    }
    .toast-success .toast-icon{
      background:#bbf7d0;
      color:#14532d;
    }
    .toast-error{
      border-color:rgba(239,68,68,.8);
      background:linear-gradient(135deg,rgba(185,28,28,.96),rgba(127,29,29,.96));
    }
    .toast-error .toast-icon{
      background:#fee2e2;
      color:#7f1d1d;
    }

    @media (max-width:960px){
      .calendar-day{
        font-size:0.7rem;
        aspect-ratio:auto;
        padding-top:0.2rem;
        padding-bottom:0.2rem;
      }
      .header-inner{
        padding:.8rem 1rem .7rem;
      }
      .dash-layout{
        grid-template-columns:minmax(0,1fr);
      }
      .cards-grid{
        grid-template-columns:minmax(0,1fr);
      }
      .site-main{
        padding:1rem .9rem 1.6rem;
      }
      .toast{
        left:.9rem;
        right:.9rem;
      }
    }
    @media (max-width:640px){
      .header-actions{
        gap:.45rem;
      }
      .chip-pill{display:none;}
      .slot-form .slot-row{
        grid-template-columns:repeat(1,minmax(0,1fr));
      }
      .field-group{
        grid-template-columns:1fr;
      }
      .calendar-controls{
        justify-content:flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="site">
    <header class="site-header">
      <div class="header-inner">
        <div class="header-left">
          <button class="btn-home" type="button" onclick="window.location.href='/'">
            ‚üµ Home
          </button>
          <a href="/" class="brand" aria-label="Terug naar Vrijeplek home">
            <div class="brand-mark">V</div>
            <div class="brand-wordmark">
              <span>vrijeplek</span>
              <span>last minute afspreken</span>
            </div>
          </a>
        </div>
        <div class="header-actions">
          <div class="chip-pill">
            <span class="chip-dot"></span>
            <span>Dashboard actief</span>
          </div>
          <button class="btn-head" type="button" onclick="window.open('/', '_blank')">
            Website bekijken
          </button>
          <button class="btn-head btn-head-primary" type="button" id="logout-btn">
            Uitloggen
          </button>
        </div>
      </div>
    </header>

    <main class="site-main">
      <div class="dash-shell">
        <div class="dash-layout">
          <aside class="dash-tabs" aria-label="Dashboard navigatie">
            <button class="dash-tab is-active" data-panel="afspraken">
              <span class="dash-tab-icon">üìÖ</span>
              <span class="dash-tab-label">Afspraken</span>
              <span class="dash-tab-sub">Vandaag & binnenkort</span>
            </button>
            <button class="dash-tab" data-panel="tijden">
              <span class="dash-tab-icon">‚ú®</span>
              <span class="dash-tab-label">Open tijdstippen</span>
              <span class="dash-tab-sub">Kalender & tijdsloten</span>
            </button>
            <button class="dash-tab" data-panel="website">
              <span class="dash-tab-icon">üåê</span>
              <span class="dash-tab-label">Website</span>
              <span class="dash-tab-sub">Jouw Vrijeplek-pagina</span>
            </button>
            <button class="dash-tab" data-panel="instellingen">
              <span class="dash-tab-icon">‚öô</span>
              <span class="dash-tab-label">Instellingen</span>
              <span class="dash-tab-sub">Gegevens & facturen</span>
            </button>
          </aside>

          <section class="dash-panels">
            <!-- AFSPRAKEN -->
            <section class="dash-panel is-visible" id="panel-afspraken">
              <header class="panel-head">
                <h1>Jouw Vrijeplek</h1>
                <p class="panel-intro">
                  Hier verschijnen straks de echte boekingen die via jouw vrije tijdsloten binnenkomen.
                </p>
              </header>

              <section class="card card-soft">
                <h2 class="card-title">Afspraken</h2>
                <p class="card-subtitle">Overzicht van aankomende boekingen.</p>

                <div class="empty-state" id="appointments-empty">
                  <p><strong>Nog geen afspraken.</strong></p>
                  <p>Maak eerst enkele open tijdstippen aan. Zodra klanten boeken, zie je ze hier automatisch verschijnen.</p>
                  <button type="button" class="btn-ghost" data-panel-jump="tijden">
                    ‚ûú Open tijdstippen beheren
                  </button>
                </div>

                <div id="appointments-list" style="display:none;"></div>
              </section>
            </section>

            <!-- OPEN TIJDSTIPPEN -->
            <section class="dash-panel" id="panel-tijden">
              <header class="panel-head">
                <h1>Open tijdstippen</h1>
                <p class="panel-intro">
                  Klik in de kalender, voeg een tijdslot toe en kies zelf of het zichtbaar is op Vrijeplek.
                </p>
              </header>

              <div class="cards-grid">
                <section class="card card-glass">
                  <header class="card-header-row">
                    <div>
                      <h2 class="card-title">Kalender</h2>
                      
                    </div>
                    <div class="calendar-controls">
                      <button type="button" class="btn-ghost" data-cal-prev>‚Äπ</button>
                      <div class="calendar-month">
                        <span data-cal-month>Maand</span>
                        <span data-cal-year>Jaar</span>
                      </div>
                      <button type="button" class="btn-ghost" data-cal-next>‚Ä∫</button>
                      <button type="button" class="btn-pill" data-cal-today>Vandaag</button>
                    </div>
                  </header>

                  <div class="calendar-shell">
                    <div class="calendar-days-row">
                      <span>Ma</span><span>Di</span><span>Wo</span><span>Do</span><span>Vr</span><span>Za</span><span>Zo</span>
                    </div>
                    <div class="calendar-grid" data-cal-grid></div>
                  </div>
                </section>

                <section class="card card-soft">
                  <h2 class="card-title">
                    Tijdslot voor <span data-selected-date>geen datum geselecteerd</span>
                  </h2>
                  <p class="card-subtitle">
                    Kies eerst een dag in de kalender en vul hieronder jouw vrije plek in.
                  </p>

                  <form class="slot-form" id="slot-form">
                    <div class="slot-row">
                      <div class="field">
                        <label for="slot-start">Startuur</label>
                        <input type="time" id="slot-start" name="start">
                      </div>
                      <div class="field">
                        <label for="slot-end">Einduur</label>
                        <input type="time" id="slot-end" name="end">
                      </div>
                      <div class="field">
                        <label for="slot-places">Aantal plaatsen (optioneel)</label>
                        <input type="number" id="slot-places" name="places" min="1" placeholder="1">
                      </div>
                    </div>

                    <div class="field">
                      <label for="slot-desc">Omschrijving (zichtbaar voor klant)</label>
                      <input
                        type="text"
                        id="slot-desc"
                        name="description"
                        placeholder="bv. ‚ÄòKapper ‚Äî snit &amp; brushing (45 min)‚Äô"
                      >
                    </div>

                    <div class="field">
                      <label class="switch">
                        <input type="checkbox" id="slot-visible" name="visible" checked>
                        <span class="switch-slider"></span>
                        <span class="switch-label">Zichtbaar op Vrijeplek</span>
                      </label>
                    </div>

                    <div class="field">
                      <label class="switch">
                        <input type="checkbox" id="slot-deposit" name="slot_deposit">
                        <span class="switch-slider"></span>
                        <span class="switch-label">Voor dit tijdslot voorschot vragen</span>
                      </label>
                      <p class="helper">
                        Dit volgt je standaard IBAN/voorschotregels uit de instellingen. Handig als sommige vrije plekken
                        zonder voorschot mogen, en andere niet.
                      </p>
                    </div>

                    <p class="helper">
                      Voorbeeld: ‚ÄúVrije plek: tandarts ‚Äî controle (30 min)‚Äù of
                      ‚ÄúVrije plek: gyproc-offerte ter plaatse (1u)‚Äù.
                    </p>

                    <div class="form-actions">
                      <button type="submit" class="btn-primary" id="slot-submit-btn">
                        Ôºã Tijdslot opslaan
                      </button>
                    </div>
                  </form>

                  <hr class="card-divider">

                  <div class="slot-list">
                    <h3>Bestaande tijdstippen op <span data-selected-date-short>‚Äì</span></h3>
                    <p class="helper">
                      Hier zie je alle open tijdstippen voor de gekozen dag. Zodra een tijdslot geboekt is,
                      wordt het gemarkeerd en kun je het niet meer aanpassen.
                    </p>
                    <div class="empty-state" id="slot-empty">
                      <p><strong>Nog geen tijdstippen voor deze dag.</strong></p>
                      <p>Voeg hierboven een eerste vrij moment toe.</p>
                    </div>
                    <div id="slot-list"></div>
                  </div>
                </section>
              </div>
            </section>

            <!-- WEBSITE -->
            <section class="dash-panel" id="panel-website">
              <header class="panel-head">
                <h1>Website</h1>
                <p class="panel-intro">
                  Bouw of pas jouw Vrijeplek-pagina aan. Dit is wat klanten zien wanneer ze jouw vrije plek openen.
                </p>
              </header>

              <section class="card card-soft">
                <h2 class="card-title">AI websitebuilder</h2>
                <p class="card-subtitle">
                  Laat Vrijeplek automatisch een stijlvolle pagina voor je ontwerpen. Jij kiest foto‚Äôs, kleuren en teksten ‚Äì
                  AI doet de rest.
                </p>

                <button type="button" class="btn-primary" onclick="window.location.href='/builder.html'">
                  Open de websitebuilder
                </button>

                <hr class="card-divider">

                <h3>Link naar jouw Vrijeplek</h3>
                <p class="helper">
                  De publieke link naar jouw pagina verschijnt hier zodra jouw profiel compleet is.
                  Ideaal voor in je e-mailhandtekening of op Facebook.
                </p>
                <p class="example">Voorbeeld: https://vrijeplek.be/kapper-janssens</p>

                <div id="public-url"></div>
              </section>
            </section>

            <!-- INSTELLINGEN -->
            <section class="dash-panel" id="panel-instellingen">
              <header class="panel-head">
                <h1>Instellingen &amp; facturatie</h1>
                <p class="panel-intro">
                  Jouw bedrijfsgegevens voor facturen van Vrijeplek + optioneel voorschot voor jouw eigen klanten.
                </p>
              </header>

              <section class="card card-soft">
                <p class="badge-warning" id="settings-status">
                  Gegevens nog niet opgeslagen
                </p>

                <form id="settings-form" class="settings-form">
                  <fieldset class="settings-group">
                    <legend>Bedrijf</legend>
                    <div class="field">
                      <label for="company-name">Bedrijfsnaam</label>
                      <input id="company-name" name="company_name" type="text" autocomplete="organization">
                    </div>
                    <div class="field">
                      <label for="contact-name">Naam contactpersoon</label>
                      <input id="contact-name" name="contact_name" type="text">
                    </div>
                    <div class="field">
                      <label for="billing-email">E-mailadres voor facturen</label>
                      <input id="billing-email" name="billing_email" type="email" autocomplete="email">
                    </div>
                    <div class="field">
                      <label for="phone">Telefoon / GSM</label>
                      <input id="phone" name="phone" type="tel" autocomplete="tel">
                    </div>
                  </fieldset>

                  <fieldset class="settings-group">
                    <legend>Facturatie Vrijeplek-abonnement</legend>
                    <div class="field">
                      <label for="vat-number">Btw-nummer</label>
                      <input id="vat-number" name="vat_number" type="text" placeholder="BE0‚Ä¶">
                    </div>
                    <div class="field">
                      <label for="invoice-note">Standaard factuurnoot (op factuur van Vrijeplek naar jouw bedrijf)</label>
                      <textarea id="invoice-note" name="invoice_note" rows="2"
                        placeholder="Eventuele interne referentie of boodschap op de factuur van Vrijeplek."></textarea>
                    </div>
                  </fieldset>

                  <fieldset class="settings-group">
                    <legend>Voorschot bij boeking (optioneel)</legend>

                    <p class="helper">
                      Dit gaat over het <strong>voorschot dat jouw klant rechtstreeks aan jouw bedrijf betaalt</strong>
                      wanneer hij via Vrijeplek een afspraak vastlegt.<br>
                      <strong>Vrijeplek factureert alleen jouw abonnement</strong> aan jouw bedrijf.
                      Wij voorzien enkel de betaalinterface ‚Äì het voorschot komt op jouw rekening.
                    </p>

                    <label class="switch">
                      <input type="checkbox" id="deposit-enabled" name="deposit_enabled">
                      <span class="switch-slider"></span>
                      <span class="switch-label">Voorschot vragen bij elke online boeking</span>
                    </label>

                    <div class="deposit-settings" data-deposit-block>
                      <div class="field">
                        <label for="iban">IBAN rekeningnummer (voor jouw voorschot)</label>
                        <input id="iban" name="iban" type="text" placeholder="BE00 0000 0000 0000">
                      </div>
                      <div class="field">
                        <label for="bic">BIC (optioneel)</label>
                        <input id="bic" name="bic" type="text" placeholder="GKCCBEBB">
                      </div>
                      <div class="field">
                        <label for="deposit-amount">Standaard voorschotbedrag</label>
                        <div class="input-with-prefix">
                          <span>‚Ç¨</span>
                          <input id="deposit-amount" name="deposit_amount" type="number" min="0" step="1"
                            placeholder="bv. 20">
                        </div>
                        <p class="helper">
                          Dit is het bedrag dat de klant vooraf betaalt bij een online boeking.
                          Het wordt op jouw IBAN gestort; Vrijeplek blijft hier volledig buiten.
                        </p>
                      </div>
                    </div>
                  </fieldset>

                  <fieldset class="settings-group settings-group-muted">
                    <legend>Vrijeplek facturatiegegevens</legend>
                    <p class="helper">
                      Dit zijn de gegevens van Vrijeplek die op jouw abonnement-factuur verschijnen:
                    </p>
                    <p class="example">
                      Vrijeplek.be<br>
                      Breeerweg 15A<br>
                      3665 As<br>
                      BTW: BE0742.671.986
                    </p>

                    <div class="field">
                      <label for="extra-footer">Extra info onderaan factuur (optioneel)</label>
                      <textarea id="extra-footer" name="extra_footer" rows="2"
                        placeholder="Bv. ‚ÄòBetaling binnen 14 dagen na factuurdatum.‚Äô"></textarea>
                    </div>
                  </fieldset>

                  <p class="helper">
                    Door op <strong>Instellingen opslaan</strong> te klikken, gebruik je deze gegevens voor
                    facturen van Vrijeplek naar jouw bedrijf en voor bevestigingsmails naar jouw klanten.
                  </p>

                  <div class="form-actions">
                    <button type="submit" class="btn-primary">Instellingen opslaan</button>
                  </div>
                </form>
              </section>
            </section>
          </section>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <span>¬© <span id="year-span"></span> Vrijeplek.be ‚Äî Last minute afspraken, netjes geregeld.</span>
        <span><a href="/voorwaarden.html">Algemene voorwaarden</a></span>
      </div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="vp-toast" class="toast" role="status" aria-live="polite" aria-atomic="true" style="display:none;">
    <div class="toast-icon">‚úì</div>
    <div class="toast-text"></div>
  </div>

  <script src="/js/config.js?v=2"></script>
  <script>
    // -------- EMAIL VANUIT URL OF LOCALSTORAGE (optioneel, mag ontbreken) ----------
    console.log('Dashboard script loading...');
    const urlParams = new URLSearchParams(window.location.search);
    let dashboardEmail = urlParams.get('email')
      ? decodeURIComponent(urlParams.get('email'))
      : null;

    if (!dashboardEmail) {
      const stored = localStorage.getItem('vp_email');
      if (stored) dashboardEmail = stored;
    }
    if (dashboardEmail) {
      localStorage.setItem('vp_email', dashboardEmail);
    }

    const API_SLOTS   = '/.netlify/functions/slots';
    const API_PROFILE = '/.netlify/functions/profile';

    function formatDateKey(date){
      const d = new Date(date.getTime());
      d.setHours(0,0,0,0);
      return d.toISOString().slice(0,10);
    }

    function showToast(message, type = 'success'){
      const toast = document.getElementById('vp-toast');
      if(!toast) return;
      const icon = toast.querySelector('.toast-icon');
      const text = toast.querySelector('.toast-text');

      text.textContent = message;
      toast.classList.remove('toast-success','toast-error','is-visible');
      toast.style.display = 'flex';

      if(type === 'error'){
        toast.classList.add('toast-error');
        if(icon) icon.textContent = '!';
      }else{
        toast.classList.add('toast-success');
        if(icon) icon.textContent = '‚úì';
      }

      requestAnimationFrame(() => {
        toast.classList.add('is-visible');
      });

      setTimeout(() => {
        toast.classList.remove('is-visible');
      }, 3200);
    }

    // ---------- SLOTS API ----------

    async function fetchSlotsForDate(dateKey){
      const url = new URL(API_SLOTS, window.location.origin);
      url.searchParams.set('date', dateKey);
      if (dashboardEmail) {
        url.searchParams.set('email', dashboardEmail);
      }

      const res = await fetch(url.toString(), {
        method: 'GET',
        credentials: 'include'
      });
      if(!res.ok){
        throw new Error(await res.text());
      }
      return res.json();
    }
    async function createSlot(payload){
      const res = await fetch(API_SLOTS, {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        credentials: 'include',
        body: JSON.stringify(payload)
      });
      if(!res.ok){
        throw new Error(await res.text());
      }
      return res.json();
    }

    async function updateSlot(payload){
      const res = await fetch(API_SLOTS, {
        method:'PUT',
        headers:{ 'Content-Type':'application/json' },
        credentials:'include',
        body:JSON.stringify(payload)
      });
      if(!res.ok){
        throw new Error(await res.text());
      }
      return res.json();
    }

    async function deleteSlot(id){
      const url = new URL(API_SLOTS, window.location.origin);
      url.searchParams.set('id', id);
      const res = await fetch(url.toString(), {
        method:'DELETE',
        credentials:'include'
      });
      if(!res.ok){
        throw new Error(await res.text());
      }
      try{
        return await res.json();
      }catch{
        return null;
      }
    }

    function renderSlotList(slotArray, slotListEl, slotEmptyEl){
      if(!slotListEl || !slotEmptyEl) return;
      if(!slotArray || !slotArray.length){
        slotListEl.innerHTML = '';
        slotListEl.style.display = 'none';
        slotEmptyEl.style.display = 'block';
        return;
      }

      slotEmptyEl.style.display = 'none';
      slotListEl.style.display = 'block';

      const rows = slotArray.map(item => {
        const start = item.start_time || item.start || '';
        const end = item.end_time || item.end || '';
        const desc = item.description || item.desc || 'Geen omschrijving';
        const places = item.places || item.places_count || 1;
        const visible = typeof item.visible === 'boolean' ? item.visible : true;
        const depositRequired = !!(item.deposit_required || item.with_deposit);
        const visibleText = visible ? 'Zichtbaar op Vrijeplek' : 'Verborgen';
        const depositText = depositRequired ? 'Voorschot actief' : 'Geen voorschot';
        const booked = !!(item.is_booked || item.booked || item.status === 'Geboekt' || item.status === 'Bezet');
        const bookedLabel = booked ? 'Geboekt ‚Ä¢ niet meer wijzigbaar (server beslist)' : `${places} plaats(en) ‚Ä¢ ${visibleText} ‚Ä¢ ${depositText}`;
        const editDisabled = booked ? 'disabled aria-disabled="true"' : '';
        const idAttr = item.id || item.slot_id || '';

        return `
          <div class="slot-item ${booked ? 'is-booked' : ''}" data-slot-id="${idAttr}">
            <div class="slot-item-header">
              <div>
                <div class="slot-item-title">${start} ‚Äì ${end}</div>
                <div class="slot-item-desc">${desc}</div>
                <div class="slot-meta">${bookedLabel}</div>
              </div>
            </div>
            <div class="slot-actions">
              <button type="button" class="btn-ghost btn-small" data-slot-edit="${idAttr}" ${editDisabled}>
                Aanpassen
              </button>
              <button type="button" class="btn-ghost btn-small btn-danger" data-slot-delete="${idAttr}" ${editDisabled}>
                Verwijderen
              </button>
            </div>
          </div>
        `;
      });

      slotListEl.innerHTML = rows.join('');
    }

    // ---------- PROFIEL / INSTELLINGEN API ----------

    async function fetchProfile(){
      if (!dashboardEmail) {
        return null; // of eventueel een foutmelding tonen
      }

      const url = new URL(API_PROFILE, window.location.origin);
      url.searchParams.set('email', dashboardEmail);

      const res = await fetch(url.toString(), {
        method: 'GET',
        credentials: 'include'
      });

      if (res.status === 404) {
        return null;
      }
      if (!res.ok) {
        throw new Error(await res.text());
      }
      return res.json();
    }

    async function saveProfile(payload){
      if (!dashboardEmail) {
        throw new Error('Geen e-mailadres gevonden');
      }

      // Send payload with email - the API will handle field mapping
      const profilePayload = {
        email: dashboardEmail,
        ...payload
      };

      const res = await fetch(API_PROFILE, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(profilePayload)
      });

      if (!res.ok) {
        const errorData = await res.json().catch(() => ({ error: await res.text() }));
        throw new Error(errorData.error || errorData.details || 'Failed to save profile');
      }

      return res.json();
    }

    function applyProfileToForm(profile){
      if(!profile) return;
      const byId = (id) => document.getElementById(id);

      // Support both new field names and legacy field names
      if(byId('company-name'))  byId('company-name').value  = profile.company_name || profile.zaak || '';
      if(byId('contact-name'))  byId('contact-name').value  = profile.contact_name || '';
      if(byId('billing-email')) byId('billing-email').value = profile.billing_email || '';
      if(byId('phone'))         byId('phone').value         = profile.phone || profile.telefoon || '';
      if(byId('vat-number'))    byId('vat-number').value    = profile.vat_number || profile.btw || '';
      if(byId('invoice-note'))  byId('invoice-note').value  = profile.invoice_note || profile.deposit_note || '';
      if(byId('iban'))          byId('iban').value          = profile.iban || profile.bank_iban || '';
      if(byId('bic'))           byId('bic').value           = profile.bic || '';
      if(byId('deposit-amount'))byId('deposit-amount').value= profile.deposit_amount ?? '';
      if(byId('extra-footer'))  byId('extra-footer').value  = profile.extra_footer || '';

      const depositEnabledInput = document.getElementById('deposit-enabled');
      if(depositEnabledInput){
        depositEnabledInput.checked = !!profile.deposit_enabled;
        const event = new Event('change');
        depositEnabledInput.dispatchEvent(event);
      }

      const status = document.getElementById('settings-status');
      if(status){
        status.textContent = 'Instellingen opgeslagen';
        status.style.background = 'rgba(22,163,74,.18)';
        status.style.borderColor = 'rgba(34,197,94,.7)';
        status.style.color = '#bbf7d0';
      }
    }

    function collectSettingsPayload(){
      const getVal = (id) => {
        const el = document.getElementById(id);
        return el ? el.value.trim() : '';
      };
      const getNumber = (id) => {
        const el = document.getElementById(id);
        if(!el) return null;
        const v = el.value.trim();
        if(!v) return null;
        const n = Number(v);
        return Number.isNaN(n) ? null : n;
      };
      const getChecked = (id) => {
        const el = document.getElementById(id);
        return el ? !!el.checked : false;
      };

      return {
        company_name:   getVal('company-name'),
        contact_name:   getVal('contact-name'),
        billing_email:  getVal('billing-email'),
        phone:          getVal('phone'),
        vat_number:     getVal('vat-number'),
        invoice_note:   getVal('invoice-note'),
        deposit_enabled:getChecked('deposit-enabled'),
        iban:           getVal('iban'),
        bic:            getVal('bic'),
        deposit_amount: getNumber('deposit-amount'),
        extra_footer:   getVal('extra-footer')
      };
    }

    // SIMPLE, DIRECT TAB CLICK HANDLER - NO CLONING, NO COMPLEXITY
    function handleTabClick(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
      }
      
      const tab = e ? e.currentTarget : this;
      const target = tab.getAttribute('data-panel');
      
      if (!target) {
        console.error('Tab has no data-panel attribute');
        return;
      }
      
      console.log('=== TAB CLICKED ===', target);
      
      // Update active tab
      document.querySelectorAll('.dash-tab').forEach(t => {
        t.classList.remove('is-active');
      });
      tab.classList.add('is-active');
      
      // Show/hide panels
      document.querySelectorAll('.dash-panel').forEach(panel => {
        if (panel.id === `panel-${target}`) {
          panel.classList.add('is-visible');
          console.log('Showing panel:', panel.id);
        } else {
          panel.classList.remove('is-visible');
        }
      });
      
      return false;
    }
    
    // EVENT DELEGATION AS FALLBACK - WORKS EVEN IF DIRECT HANDLERS FAIL
    document.addEventListener('click', function(e) {
      const tab = e.target.closest('.dash-tab');
      if (tab && !tab.hasAttribute('data-handled')) {
        tab.setAttribute('data-handled', 'true');
        console.log('Event delegation caught tab click:', tab.getAttribute('data-panel'));
        handleTabClick.call(tab, e);
        setTimeout(() => tab.removeAttribute('data-handled'), 100);
      }
    }, false); // Bubble phase to avoid interfering with direct handlers

    // Initialize dashboard - SIMPLE AND DIRECT
    function initDashboard() {
      console.log('=== DASHBOARD INIT START ===');
      
      // Check if DOM is ready
      if (!document.body) {
        console.error('Document body not ready');
        setTimeout(initDashboard, 100);
        return;
      }

      // Year span
      const yearSpan = document.getElementById('year-span');
      if(yearSpan){
        yearSpan.textContent = new Date().getFullYear();
      }

      // TABS - SIMPLE DIRECT ATTACHMENT
      const tabs = document.querySelectorAll('.dash-tab');
      console.log('Found tabs:', tabs.length);
      
      if (tabs.length === 0) {
        console.error('NO TABS FOUND! Retrying in 200ms...');
        setTimeout(initDashboard, 200);
        return;
      }
      
      // Remove ALL existing listeners and attach fresh ones
      tabs.forEach((tab, index) => {
        // Remove any existing listeners by cloning
        const newTab = tab.cloneNode(true);
        tab.parentNode.replaceChild(newTab, tab);
        
        // Make absolutely sure it's clickable - FORCE ALL STYLES
        newTab.style.setProperty('cursor', 'pointer', 'important');
        newTab.style.setProperty('pointer-events', 'auto', 'important');
        newTab.style.setProperty('user-select', 'none', 'important');
        newTab.style.setProperty('position', 'relative', 'important');
        newTab.style.setProperty('z-index', '999', 'important');
        newTab.style.setProperty('background', '', 'important');
        newTab.style.setProperty('opacity', '1', 'important');
        
        // Remove any attributes that might block
        newTab.removeAttribute('disabled');
        newTab.removeAttribute('aria-disabled');
        
        // Attach click handler MULTIPLE WAYS for redundancy
        newTab.onclick = function(e) {
          console.log('onclick fired for:', newTab.getAttribute('data-panel'));
          return handleTabClick.call(this, e);
        };
        newTab.addEventListener('click', handleTabClick, true); // Capture
        newTab.addEventListener('click', handleTabClick, false); // Bubble
        newTab.addEventListener('mousedown', function(e) {
          console.log('mousedown on tab:', newTab.getAttribute('data-panel'));
          e.preventDefault();
          handleTabClick.call(newTab, e);
        }, false);
        
        // Also make it work with touch events
        newTab.addEventListener('touchend', function(e) {
          console.log('touchend on tab:', newTab.getAttribute('data-panel'));
          e.preventDefault();
          handleTabClick.call(newTab, e);
        }, false);
        
        console.log(`Tab ${index} (${newTab.getAttribute('data-panel')}) - ALL handlers attached`);
      });

      // Panel jump buttons
      document.querySelectorAll('[data-panel-jump="tijden"]').forEach(btn => {
        btn.style.cssText = 'cursor: pointer !important; pointer-events: auto !important;';
        btn.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          const targetTab = document.querySelector('.dash-tab[data-panel="tijden"]');
          if (targetTab) {
            targetTab.click();
          }
        };
        btn.addEventListener('click', btn.onclick, false);
      });

      const depositToggle = document.getElementById('deposit-enabled');
      const depositBlock = document.querySelector('[data-deposit-block]');
      if (depositToggle && depositBlock) {
        const updateDepositState = () => {
          if (depositToggle.checked) {
            depositBlock.classList.remove('is-disabled');
          } else {
            depositBlock.classList.add('is-disabled');
          }
        };
        depositToggle.addEventListener('change', updateDepositState);
        updateDepositState();
      }

      // kalender + slots
      const slotForm   = document.getElementById('slot-form');
      const slotList   = document.getElementById('slot-list');
      const slotEmpty  = document.getElementById('slot-empty');
      const slotStart  = document.getElementById('slot-start');
      const slotEnd    = document.getElementById('slot-end');
      const slotPlaces = document.getElementById('slot-places');
      const slotDesc   = document.getElementById('slot-desc');
      const slotVisible= document.getElementById('slot-visible');
      const slotDeposit= document.getElementById('slot-deposit');
      const slotSubmitBtn = document.getElementById('slot-submit-btn');

      const grid = document.querySelector('[data-cal-grid]');
      const monthLabel = document.querySelector('[data-cal-month]');
      const yearLabel = document.querySelector('[data-cal-year]');
      const selectedLabel = document.querySelector('[data-selected-date]');
      const selectedShort = document.querySelector('[data-selected-date-short]');

      let current = new Date();
      current.setDate(1);
      let selected = new Date();
      selected.setHours(0,0,0,0);

      const slotsCache = {};
      let editingSlotId = null;

      const monthNames = [
        'januari','februari','maart','april','mei','juni',
        'juli','augustus','september','oktober','november','december'
      ];
      const weekdayNames = [
        'maandag','dinsdag','woensdag','donderdag','vrijdag','zaterdag','zondag'
      ];

      function updateSelectedLabels(){
        if (!selected) {
          if(selectedLabel) selectedLabel.textContent = 'geen datum geselecteerd';
          if(selectedShort) selectedShort.textContent = '‚Äì';
          return;
        }
        const d = selected.getDate();
        const m = selected.getMonth();
        const weekdayIndex = (selected.getDay() + 6) % 7;
        let long = `${weekdayNames[weekdayIndex]} ${d} ${monthNames[m]}`;
        long = long.charAt(0).toUpperCase() + long.slice(1);

        if(selectedLabel){
          selectedLabel.textContent = long;
        }
        if(selectedShort){
          selectedShort.textContent = selected.toLocaleDateString('nl-BE', {
            day:'2-digit', month:'2-digit', year:'numeric'
          });
        }
      }

      function wireSlotButtonsForDate(dateKey){
        if(!slotList) return;
        const slotArray = slotsCache[dateKey] || [];

        slotList.querySelectorAll('[data-slot-edit]').forEach(btn => {
          const id = btn.getAttribute('data-slot-edit');
          const slot = slotArray.find(s => (s.id || s.slot_id) === id);
          if(!slot) return;

          btn.addEventListener('click', () => {
            editingSlotId = id;
            slotStart.value  = slot.start_time || slot.start || '';
            slotEnd.value    = slot.end_time || slot.end || '';
            slotPlaces.value = slot.places || slot.places_count || 1;
            slotDesc.value   = slot.description || slot.desc || '';
            slotVisible.checked = typeof slot.visible === 'boolean' ? slot.visible : true;
            if(slotDeposit){
              slotDeposit.checked = !!(slot.deposit_required || slot.with_deposit);
            }
            if(slotSubmitBtn){
              slotSubmitBtn.textContent = 'Tijdslot bijwerken';
            }
            showToast('Tijdslot geladen om aan te passen','success');
            slotForm.scrollIntoView({behavior:'smooth', block:'start'});
          });
        });

        slotList.querySelectorAll('[data-slot-delete]').forEach(btn => {
          const id = btn.getAttribute('data-slot-delete');
          const slot = slotArray.find(s => (s.id || s.slot_id) === id);
          if(!slot) return;

          btn.addEventListener('click', async () => {
            if(btn.disabled) return;
            const ok = confirm('Weet je zeker dat je dit tijdslot wil verwijderen? Als het al geboekt is, kan de server dit weigeren.');
            if(!ok) return;
            try{
              await deleteSlot(id);
              showToast('Tijdslot verwijderd','success');
              await loadSlotsForSelectedDate();
            }catch(err){
              console.error(err);
              showToast('Verwijderen mislukt: ' + (err.message || err),'error');
            }
          });
        });
      }

      async function loadSlotsForSelectedDate(){
        if(!grid || !selected) return;
        const key = formatDateKey(selected);
        try{
          const data = await fetchSlotsForDate(key);
          slotsCache[key] = data || [];
          renderSlotList(slotsCache[key], slotList, slotEmpty);
          wireSlotButtonsForDate(key);
        }catch(err){
          console.error(err);
          showToast('Kon de tijdstippen niet laden: ' + (err.message || err),'error');
        }
      }

      function renderCalendar(){
        if(!grid) return;
        const year = current.getFullYear();
        const month = current.getMonth();
        if(monthLabel){
          monthLabel.textContent = monthNames[month][0].toUpperCase() + monthNames[month].slice(1);
        }
        if(yearLabel){
          yearLabel.textContent = year;
        }

        grid.innerHTML = '';
        const firstDay = new Date(year, month, 1);
        const startWeekday = (firstDay.getDay() + 6) % 7;
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();
        today.setHours(0,0,0,0);

        for (let i = 0; i < startWeekday; i++) {
          const pad = document.createElement('div');
          grid.appendChild(pad);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const date = new Date(year, month, d);
          date.setHours(0,0,0,0);
          const cell = document.createElement('button');
          cell.type = 'button';
          cell.className = 'calendar-day';
          cell.textContent = d;

          if (date.getTime() === today.getTime()) {
            cell.classList.add('is-today');
          }
          if (selected && date.getTime() === selected.getTime()) {
            cell.classList.add('is-selected');
          }

          cell.addEventListener('click', async () => {
            selected = date;
            updateSelectedLabels();
            renderCalendar();
            await loadSlotsForSelectedDate();
          });

          grid.appendChild(cell);
        }
      }

      document.querySelector('[data-cal-prev]')?.addEventListener('click', () => {
        current.setMonth(current.getMonth() - 1);
        renderCalendar();
      });
      document.querySelector('[data-cal-next]')?.addEventListener('click', () => {
        current.setMonth(current.getMonth() + 1);
        renderCalendar();
      });
      document.querySelector('[data-cal-today]')?.addEventListener('click', async () => {
        current = new Date();
        current.setDate(1);
        selected = new Date();
        selected.setHours(0,0,0,0);
        updateSelectedLabels();
        renderCalendar();
        await loadSlotsForSelectedDate();
      });

      if(slotForm){
        slotForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          if(!selected){
            alert('Kies eerst een datum in de kalender.');
            return;
          }

          const startVal  = slotStart.value;
          const endVal    = slotEnd.value;
          const descVal   = slotDesc.value.trim();
          const placesVal = slotPlaces.value ? parseInt(slotPlaces.value, 10) : 1;
          const visibleVal= !!slotVisible.checked;
          const depositPerSlot = slotDeposit ? !!slotDeposit.checked : false;

          if(!startVal || !endVal){
            alert('Vul minstens een start- en einduur in.');
            return;
          }

          const dateKey = formatDateKey(selected);

          const payloadBase = {
            date: dateKey,
            start: startVal,
            end: endVal,
            places: placesVal,
            description: descVal,
            visible: visibleVal,
            deposit_required: depositPerSlot
          };

          // email meesturen indien we hem kennen, maar niet blokkeren als hij ontbreekt
          if(dashboardEmail){
            payloadBase.email = dashboardEmail;
          }

          try{
            if(editingSlotId){
              await updateSlot({ ...payloadBase, id: editingSlotId });
            }else{
              await createSlot(payloadBase);
            }

            slotForm.reset();
            slotVisible.checked = true;
            if(slotDeposit){ slotDeposit.checked = false; }
            const msg = editingSlotId ? 'Tijdslot bijgewerkt' : 'Tijdslot opgeslagen';
            editingSlotId = null;
            if(slotSubmitBtn){
              slotSubmitBtn.textContent = 'Ôºã Tijdslot opslaan';
            }

            showToast(msg,'success');
            await loadSlotsForSelectedDate();
          }catch(err){
            console.error(err);
            showToast('Tijdslot kon niet worden opgeslagen: ' + (err.message || err),'error');
          }
        });
      }

            const settingsForm = document.getElementById('settings-form');
      if (settingsForm) {
        settingsForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          // email is verplicht voor de backend
          if (!dashboardEmail) {
            showToast(
              'Geen e-mailadres gevonden voor dit account. Log opnieuw in via je Vrijeplek-link.',
              'error'
            );
            return;
          }

          const payload = {
            email: dashboardEmail,          // verplicht veld voor de function
            ...collectSettingsPayload()
          };

          try {
            await saveProfile(payload);
            const status = document.getElementById('settings-status');
            if (status) {
              status.textContent = 'Instellingen opgeslagen';
              status.style.background = 'rgba(22,163,74,.18)';
              status.style.borderColor = 'rgba(34,197,94,.7)';
              status.style.color = '#bbf7d0';
            }
            showToast('Instellingen opgeslagen.','success');
          } catch (err) {
            console.error(err);
            showToast('Instellingen opslaan mislukt: ' + (err.message || err),'error');
          }
        });

        // Bij laden: bestaande instellingen ophalen
        (async () => {
          try {
            const profile = await fetchProfile();
            applyProfileToForm(profile);
          } catch (err) {
            console.error(err);
            // geen toast, dashboard mag gewoon laden
          }
        })();
      }


      const geoBtn = document.getElementById('geo-btn');
      if(geoBtn){
        const latInput = document.getElementById('business-lat');
        const lngInput = document.getElementById('business-lng');

        geoBtn.addEventListener('click', () => {
          if(!navigator.geolocation){
            alert('Locatie wordt niet ondersteund door deze browser.');
            return;
          }
          geoBtn.disabled = true;
          geoBtn.textContent = 'Locatie ophalen‚Ä¶';

          navigator.geolocation.getCurrentPosition(
            (pos) => {
              const { latitude, longitude } = pos.coords;
              if(latInput) latInput.value = latitude.toFixed(6);
              if(lngInput) lngInput.value = longitude.toFixed(6);
              geoBtn.textContent = 'Locatie ingevuld ‚úì';
              geoBtn.disabled = false;
              showToast('Locatie ingevuld.','success');
            },
            (err) => {
              console.error(err);
              alert('Locatie kon niet worden opgehaald. Controleer je browserrechten.');
              geoBtn.textContent = 'Gebruik mijn huidige locatie';
              geoBtn.disabled = false;
            },
            { enableHighAccuracy:true, timeout:10000 }
          );
        });
      }

      // Logout button - DIRECT AND SIMPLE
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn){
        logoutBtn.style.cssText = 'cursor: pointer !important; pointer-events: auto !important; position: relative; z-index: 10;';
        logoutBtn.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Logout clicked');
          window.location.href = '/logout.html';
        };
        logoutBtn.addEventListener('click', logoutBtn.onclick, false);
        console.log('Logout button handler attached');
      } else {
        console.error('Logout button not found!');
      }
      
      // Initialize calendar and load data
      renderCalendar();
      updateSelectedLabels();
      loadSlotsForSelectedDate();
      
      console.log('Dashboard initialized successfully');
      
      // FORCE ALL INTERACTIVE ELEMENTS TO BE CLICKABLE
      const allButtons = document.querySelectorAll('button, .dash-tab, [data-panel-jump], .btn-head, .btn-ghost');
      console.log('Found buttons/tabs:', allButtons.length);
      
      allButtons.forEach(el => {
        // FORCE styles with !important via setProperty
        el.style.setProperty('pointer-events', 'auto', 'important');
        el.style.setProperty('cursor', 'pointer', 'important');
        el.style.setProperty('user-select', 'none', 'important');
        el.style.setProperty('position', 'relative', 'important');
        el.style.setProperty('z-index', '999', 'important');
        el.style.setProperty('opacity', '1', 'important');
        el.removeAttribute('disabled');
        el.removeAttribute('aria-disabled');
      });
      
      // REMOVE ANY OVERLAYS THAT MIGHT BLOCK CLICKS
      const allElements = document.querySelectorAll('*');
      allElements.forEach(el => {
        const style = window.getComputedStyle(el);
        // If element has pointer-events: none and is covering tabs area, remove it
        if (
          style.pointerEvents === 'none' &&
          (style.position === 'absolute' || style.position === 'fixed')
        ) {
          const rect = el.getBoundingClientRect();
          const tabsArea = document.querySelector('.dash-tabs');
          if (tabsArea) {
            const tabsRect = tabsArea.getBoundingClientRect();
            // Check if overlay is covering tabs
            if (rect.left < tabsRect.right && rect.right > tabsRect.left &&
                rect.top < tabsRect.bottom && rect.bottom > tabsRect.top) {
              console.warn('Removing blocking overlay:', el);
              el.style.setProperty('pointer-events', 'none', 'important');
              el.style.setProperty('display', 'none', 'important');
            }
          }
        }
      });
      
      console.log('=== DASHBOARD INIT COMPLETE ===');
      console.log('Tabs:', document.querySelectorAll('.dash-tab').length);
      console.log('Panels:', document.querySelectorAll('.dash-panel').length);
      
      // Test that tabs are actually clickable
      const testTabs = document.querySelectorAll('.dash-tab');
      testTabs.forEach((tab, i) => {
        const computed = window.getComputedStyle(tab);
        console.log(`Tab ${i} (${tab.getAttribute('data-panel')}):`, {
          pointerEvents: computed.pointerEvents,
          cursor: computed.cursor,
          zIndex: computed.zIndex,
          position: computed.position
        });
      });
    }

    // MULTIPLE INITIALIZATION ATTEMPTS - BULLETPROOF
    function forceInit() {
      console.log('=== FORCE INIT CALLED ===');
      console.log('Ready state:', document.readyState);
      console.log('Body exists:', !!document.body);
      console.log('Tabs exist:', document.querySelectorAll('.dash-tab').length);
      
      try {
        initDashboard();
      } catch (err) {
        console.error('Init error:', err);
        setTimeout(forceInit, 200);
      }
    }
    
    // Try immediately
    if (document.readyState === 'complete') {
      forceInit();
    } else if (document.readyState === 'interactive') {
      setTimeout(forceInit, 50);
    } else {
      document.addEventListener('DOMContentLoaded', forceInit);
    }
    
    // Fallback attempts
    setTimeout(forceInit, 200);
    setTimeout(forceInit, 500);
    setTimeout(forceInit, 1000);
    
    // Also try on window load
    window.addEventListener('load', forceInit);
    
    // Make handleTabClick globally available as fallback
    window.handleTabClick = handleTabClick;
    
    // EMERGENCY FALLBACK - Direct tab switching function
    window.switchTab = function(panelName) {
      console.log('Emergency switchTab called for:', panelName);
      const tab = document.querySelector(`.dash-tab[data-panel="${panelName}"]`);
      if (tab) {
        handleTabClick.call(tab, null);
      }
    };
    
    // Add keyboard shortcuts as backup
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        if (e.key === '1') {
          e.preventDefault();
          window.switchTab('afspraken');
        } else if (e.key === '2') {
          e.preventDefault();
          window.switchTab('tijden');
        } else if (e.key === '3') {
          e.preventDefault();
          window.switchTab('website');
        } else if (e.key === '4') {
          e.preventDefault();
          window.switchTab('instellingen');
        }
      }
    });
  </script>

</body>
</html>

