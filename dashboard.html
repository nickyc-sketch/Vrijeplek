<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard â€” Vrijeplek</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=ocean">

  <style>
    body{font-family:'Poppins',sans-serif;margin:0;background:linear-gradient(180deg,#e9f2ff,#f6f9ff);color:#0a2a4a;}
    .site-header{background:linear-gradient(120deg,#1a66ff,#0056ff);color:#fff;padding:14px 20px;position:sticky;top:0;z-index:50;}
    .site-header .inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;}
    .site-header a.brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff;font-weight:700;font-size:20px;}
    .site-header img{height:38px;}

    .tabs-bar{background:rgba(255,255,255,0.8);backdrop-filter:blur(8px);border-bottom:1px solid rgba(26,102,255,.25);}
    .tabs-inner{max-width:1200px;margin:0 auto;display:flex;gap:16px;align-items:center;justify-content:flex-start;padding:10px 12px;}
    .tab-btn{border:none;background:none;padding:10px 18px;border-radius:999px;font-weight:600;font-size:15px;color:#0a2a4a;cursor:pointer;transition:.25s;}
    .tab-btn.active{background:linear-gradient(120deg,#1a66ff,#0056ff);color:#fff;box-shadow:0 4px 14px rgba(10,27,90,.15);}

    .content-wrap{max-width:1200px;margin:32px auto;padding:0 12px;}
    h1.section-title{font-size:26px;text-align:center;margin-bottom:18px;}
    .card{background:rgba(255,255,255,0.7);border:1px solid rgba(26,102,255,.18);border-radius:14px;box-shadow:0 4px 24px rgba(10,27,90,.06);padding:20px;margin-bottom:18px;}

    .appointment{border-bottom:1px dashed rgba(26,102,255,.25);padding:10px 0;}
    .appointment:last-child{border:none;}
    .appointment h3{margin:0;font-size:16px;color:#0a2a4a;}
    .appointment p{margin:3px 0;font-size:14px;color:#3a4b6a;}

    .field{display:flex;flex-direction:column;margin-bottom:10px;}
    .field label{font-weight:600;margin-bottom:4px;}
    .input{padding:10px;border:1px solid rgba(26,102,255,.25);border-radius:8px;}
    .btn{padding:10px 20px;border:none;border-radius:999px;background:linear-gradient(120deg,#1a66ff,#0056ff);color:#fff;font-weight:700;cursor:pointer;}
    .btn-ghost{background:rgba(255,255,255,.4);border:1px solid rgba(26,102,255,.25);color:#0a2a4a;}
    .form-row{display:grid;gap:10px;grid-template-columns:1fr 1fr 1fr;}
    @media(max-width:720px){.form-row{grid-template-columns:1fr;}}

    .settings-list li{margin-bottom:6px;}
    .hide{display:none !important;}
  </style>
</head>

<body>
  <header class="site-header">
    <div class="inner">
      <a href="dashboard.html" class="brand"><img src="img/logo.png" alt="">Vrijeplek</a>
      <button id="btn-logout" class="btn-ghost" style="padding:8px 16px;">Uitloggen</button>
    </div>
  </header>

  <div class="tabs-bar">
    <div class="tabs-inner">
      <button class="tab-btn active" data-tab="afspraken">Afspraken</button>
      <button class="tab-btn" data-tab="open">Open tijdsstippen</button>
      <button class="tab-btn" data-tab="website">Website</button>
      <button class="tab-btn" data-tab="profiel">Profiel</button>
      <button class="tab-btn" data-tab="instellingen">Instellingen</button>
    </div>
  </div>

  <main class="content-wrap">
    <h1 id="welcome-wrap" class="section-title">Welkom, <span id="user-firstname">â€”</span> ðŸ‘‹</h1>

    <section id="tab-afspraken" class="tab-content">
      <div class="card">
        <h2>Jouw afspraken</h2>
        <div id="appointments-list">
          <!-- Dynamisch: groep per dag, daaronder afspraken -->
          <!-- Voorbeeld placeholders (vervang door live data via Supabase) -->
          <div class="appointment"><h3>12 november â€” 14:00</h3><p><strong>Jan Peeters</strong> â€” Massage 60min</p></div>
          <div class="appointment"><h3>13 november â€” 09:30</h3><p><strong>Sofie Janssens</strong> â€” Intakegesprek</p></div>
        </div>
      </div>
    </section>

    <section id="tab-open" class="tab-content" hidden>
      <div class="card">
        <h2>Nieuw tijdstip publiceren</h2>
        <form id="slot-form">
          <div class="form-row">
            <div class="field"><label>Datum</label><input type="date" class="input" id="slot-date"></div>
            <div class="field"><label>Van</label><input type="time" class="input" id="slot-from"></div>
            <div class="field"><label>Tot</label><input type="time" class="input" id="slot-to"></div>
          </div>
          <div class="field"><label>Omschrijving</label><input type="text" class="input" id="slot-desc" placeholder="vb. Snelle beurt of intake"></div>
          <button class="btn" type="submit">Publiceren</button>
        </form>
      </div>
    </section>

    <section id="tab-website" class="tab-content" hidden>
      <div class="card">
        <h2>Mijn mini-website</h2>
        <p>Hier bouw je binnenkort je eigen pagina op Vrijeplek.</p>
      </div>
    </section>

    <section id="tab-profiel" class="tab-content" hidden>
      <div class="card">
        <h2>Profieloverzicht</h2>
        <ul>
          <li>E-mail: <span id="profile-email">â€”</span></li>
          <li>Bedrijfsnaam: <span id="profile-company">â€”</span></li>
          <li>BTW-nummer: <span id="profile-btw">â€”</span></li>
          <li>Categorie: <span id="profile-cat">â€”</span></li>
        </ul>
      </div>
    </section>

    <section id="tab-instellingen" class="tab-content" hidden>
      <div class="card">
        <h2>Instellingen</h2>
        <ul class="settings-list">
          <li><a href="wachtwoord-vergeten.html">Wachtwoord herstellen</a></li>
          <li><label><input type="checkbox" id="toggle-reviews"> Google reviews tonen</label></li>
          <li><label><input type="checkbox" id="toggle-public"> Publiek zichtbaar op Vrijeplek</label></li>
        </ul>
      </div>
    </section>
  </main>

  <footer class="site-footer" style="text-align:center;padding:20px 0;color:#5b6b86;font-size:13px;">
    Â© 2025 Vrijeplek. Alle rechten voorbehouden.
  </footer>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const SUPABASE_URL = 'https://xdmrikvxyeebeusnbzav.supabase.co';
    const SUPABASE_ANON_KEY = '<YOUR-ANON-KEY>';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true }
    });

    const els = {
      welcomeWrap: document.getElementById('welcome-wrap'),
      userFirst: document.getElementById('user-firstname'),
      profileEmail: document.getElementById('profile-email'),
      logout: document.getElementById('btn-logout')
    };

    function niceFirstNameFrom(user){
      const rawName = user.user_metadata?.name || user.user_metadata?.full_name || '';
      const fromMeta = (rawName || '').split(/[.\s_-]/)[0]?.trim();
      const fromEmail = (user.email || '').split('@')[0]?.trim();
      const blacklist = ['info','contact','admin','hello','hallo','sales','support'];
      const candidate = (fromMeta && fromMeta.length>1 ? fromMeta : fromEmail);
      if (!candidate) return '';
      const lower = candidate.toLowerCase();
      if (blacklist.includes(lower) || lower.length < 2) return '';
      return candidate.charAt(0).toUpperCase() + candidate.slice(1);
    }

    async function ensureSession(){
      const { data: { session } } = await supabase.auth.getSession();

      if (session?.user){
        applyUser(session.user);
        return;
      }

      const fallback = setTimeout(() => {
        location.replace('login.html');
      }, 1800);

      supabase.auth.onAuthStateChange((_event, newSession) => {
        if (newSession?.user){
          clearTimeout(fallback);
          applyUser(newSession.user);
        }
      });
    }

    function applyUser(user){
      const first = niceFirstNameFrom(user);
      if (first){
        els.userFirst.textContent = first;
        els.welcomeWrap.classList.remove('hide');
      } else {
        els.welcomeWrap.classList.add('hide');
      }
      if (els.profileEmail) els.profileEmail.textContent = user.email || '';
    }

    await ensureSession();

    document.getElementById('btn-logout')?.addEventListener('click', async ()=>{
      await supabase.auth.signOut();
      location.replace('login.html');
    });

    const tabs = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.tab-content');
    tabs.forEach(btn=>{
      btn.addEventListener('click',()=>{
        tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.dataset.tab;
        sections.forEach(sec=>sec.hidden = sec.id !== 'tab-'+id);
      });
    });

    // Open tijdstippen submit (placeholder; koppel later aan function/DB)
    document.getElementById('slot-form')?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const date = (document.getElementById('slot-date')?.value||'').trim();
      const from = (document.getElementById('slot-from')?.value||'').trim();
      const to   = (document.getElementById('slot-to')?.value||'').trim();
      const desc = (document.getElementById('slot-desc')?.value||'').trim();
      if(!date || !from || !to){ alert('Kies datum en uren.'); return; }
      alert('Tijdstip opgeslagen. (koppeling naar backend volgt)');
      e.target.reset();
    });
  </script>
</body>
</html>
