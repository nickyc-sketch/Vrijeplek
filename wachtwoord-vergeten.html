<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wachtwoord vergeten — Vrijeplek</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=smurf6">
  <style>
    .site-header::after{content:"";position:absolute;inset:auto 0 0 0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.45),transparent);opacity:.6}
    .section-title{display:flex;align-items:center;gap:10px;justify-content:center;margin:8px auto 22px;color:var(--blue-900)}
    .section-title::before,.section-title::after{content:"";flex:1 1 100px;height:1px;background:linear-gradient(90deg,transparent,rgba(26,102,255,.25),transparent)}
    .form-grid{display:grid;grid-template-columns:1fr;gap:14px}
    .tiny-note{font-size:12px;color:#5b6b86}
  </style>
</head>
<body>
  <div class="site">
    <header class="site-header">
      <div class="header-inner">
        <a href="index.html" class="brand" style="text-decoration:none;display:flex;align-items:center;gap:10px;">
          <img src="img/logo.png" alt="Vrijeplek logo" style="height:40px;" onerror="this.remove()">
          <span class="brand-name">Vrijeplek</span><span class="brand-dot"></span>
        </a>
        <nav class="header-actions">
          <a class="nav-btn" href="login.html">Login</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero" style="padding:56px 0 40px;text-align:center;">
        <div class="container hero-inner">
          <h1 class="section-title">Wachtwoord opnieuw instellen</h1>
          <p style="max-width:700px;margin:0 auto 26px;color:#1f2a44;">Vul je e-mailadres in. Je ontvangt een herstel-link.</p>

          <div class="search-wrap" style="max-width:620px; padding:18px; margin-inline:auto;">
            <div class="card-head">
              <h2>Herstel via e-mail</h2>
              <span class="badge"><span class="badge-dot"></span> Beveiligd</span>
            </div>

            <form id="forgot-form" class="form-grid" novalidate>
              <div class="field">
                <label for="fp-email">E-mailadres</label>
                <input id="fp-email" type="email" class="input" required autocomplete="email">
              </div>
              <div class="submit-zone" style="flex-direction:column;gap:10px;">
                <button type="submit" class="btn" style="min-width:220px;height:46px;">Stuur herstelmail</button>
                <div id="fp-msg" class="tiny-note"></div>
              </div>
            </form>

          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <p>© 2025 Vrijeplek. Alle rechten voorbehouden.</p>
        <nav class="footer-nav">
          <a href="voorwaarden.html">Algemene voorwaarden</a>
        </nav>
      </div>
    </footer>
  </div>

  <script src="/js/config.js"></script>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    const SUPABASE_URL = window.VRIJEPLEK?.SUPABASE_URL || window.ENV?.SUPABASE_URL || '';
    const SUPABASE_ANON_KEY = window.VRIJEPLEK?.SUPABASE_ANON_KEY || window.ENV?.SUPABASE_ANON_KEY || '';

    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
      console.error('Supabase credentials not configured.');
    }
    const supa = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: true, autoRefreshToken: true, storage: localStorage } });

    const form = document.getElementById('forgot-form');
    const email = document.getElementById('fp-email');
    const msg = document.getElementById('fp-msg');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!email.value.trim()){ msg.textContent = 'Vul je e-mailadres in.'; return; }
      msg.textContent = 'Verzenden…';

      // LET OP: zet deze URL óók in Supabase Auth → Email templates → Reset password redirect
      const redirectTo = `${location.origin}/wachtwoord-reset.html`;

      const { error } = await supa.auth.resetPasswordForEmail(email.value.trim(), { redirectTo });
      if (error) { msg.textContent = error.message || 'Kon geen herstelmail sturen.'; return; }
      msg.textContent = 'Mail verzonden. Check je inbox (en spam).';
    });
  </script>
</body>
</html>
