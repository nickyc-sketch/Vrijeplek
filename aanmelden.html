<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aanmelden — Vrijeplek</title>
  <meta name="description" content="Maak gratis een account aan op Vrijeplek. Activeer daarna je maandelijks of jaarlijks plan en vul je agenda zonder commissie.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=ocean7">

  <style>
    :root{
      --ink:#0a2a4a;
      --muted:#5b6b86;
      --line:rgba(26,102,255,.25);
      --accent:#1a66ff;
      --accent2:#0056ff;
      --danger:#ff3b3b;
      --ok:#059669;
    }

    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      background:linear-gradient(180deg,#e9f2ff,#f6f9ff);
      color:var(--ink);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:0 12px;
    }

    /* Header zoals waarom.html */
    .site-header{
      position:sticky;
      top:0;
      z-index:40;
      backdrop-filter:blur(14px);
      background:linear-gradient(180deg,rgba(248,251,FF,.96),rgba(248,251,FF,.86));
      border-bottom:1px solid rgba(26,102,255,.15);
    }
    .header-inner{
      max-width:1100px;
      margin:0 auto;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
    }
    .brand img{height:34px;}
    .brand-name{font-weight:800;color:var(--ink);}
    .brand-dot{width:6px;height:6px;border-radius:999px;background:linear-gradient(120deg,#1a66ff,#0056ff);}
    .header-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .nav-btn{
      padding:7px 13px;
      border-radius:999px;
      border:1px solid rgba(26,102,255,.22);
      font-size:13px;
      text-decoration:none;
      color:var(--ink);
      background:rgba(255,255,255,.9);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
    }
    .nav-btn[aria-current="page"]{
      border-color:rgba(26,102,255,.6);
      box-shadow:0 0 0 1px rgba(26,102,255,.12);
    }
    .btn-green{
      border-color:rgba(16,185,129,.7);
      color:#065f46;
      background:rgba(209,250,229,.9);
    }

    main{
      flex:1;
      padding:32px 0 34px;
    }

    /* Layout aanmelden */
    .signup-hero{
      padding:32px 0 10px;
    }
    .signup-grid{
      display:grid;
      grid-template-columns:1.15fr .85fr;
      gap:26px;
      align-items:flex-start;
    }
    @media(max-width:960px){
      .signup-grid{
        grid-template-columns:1fr;
      }
    }

    .signup-copy h1{
      margin:0 0 10px;
      font-size:clamp(24px,2.6vw,32px);
    }
    .signup-copy p.lead{
      margin:0 0 12px;
      font-size:14px;
      color:var(--muted);
      max-width:480px;
    }
    .plan-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-size:12px;
      font-weight:700;
      margin-top:6px;
    }
    .plan-pill span{font-weight:800;}
    .save{color:#0e9f6e;}

    .steps-list{
      margin:14px 0 0;
      padding-left:16px;
      font-size:13px;
      color:#3a4b6a;
    }
    .steps-list li{margin:4px 0;}

    .mini-note{
      margin-top:10px;
      font-size:12px;
      color:#6b7280;
    }

    /* Form card */
    .signup-card{
      padding:18px 18px 20px;
      border-radius:18px;
      border:1px solid rgba(26,102,255,.18);
      background:linear-gradient(180deg,rgba(255,255,255,.97),rgba(255,255,255,.9));
      box-shadow:0 10px 30px rgba(15,23,42,.12);
    }
    .signup-card h2{
      margin:0 0 8px;
      font-size:18px;
    }
    .signup-card p.sub{
      margin:0 0 14px;
      font-size:13px;
      color:var(--muted);
    }

    form{
      display:flex;
      flex-direction:column;
      gap:10px;
      font-size:13px;
    }
    .field label{
      display:block;
      font-weight:600;
      margin-bottom:3px;
    }
    .field input,
    .field select{
      width:100%;
      padding:9px 11px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.8);
      font-family:inherit;
      font-size:13px;
      background:rgba(248,250,252,.8);
      color:var(--ink);
    }
    .field input::placeholder{
      color:#9ca3af;
    }
    .field select option{color:#111827;}

    .two{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width:540px){
      .two{grid-template-columns:1fr;}
    }

    .terms-row{
      margin-top:4px;
    }
    .terms-label{
      display:flex;
      align-items:flex-start;
      gap:8px;
      font-size:12px;
      color:#4b5563;
      cursor:pointer;
    }
    .terms-label input{
      margin-top:2px;
      accent-color:#1a66ff;
    }
    .terms-label a{
      color:#1a66ff;
      text-decoration:underline;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin-top:6px;
      padding:11px 16px;
      border-radius:999px;
      border:none;
      background:linear-gradient(120deg,var(--accent),var(--accent2));
      color:#fff;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 10px 22px rgba(37,99,235,.35);
      transition:.2s;
      width:100%;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 30px rgba(37,99,235,.45);
    }

    #msg{
      min-height:18px;
      font-size:12px;
      margin-top:4px;
      text-align:center;
    }
    .error{color:var(--danger);font-weight:600;}
    .ok{color:var(--ok);font-weight:600;}

    .form-footnote{
      margin-top:6px;
      font-size:11px;
      color:#6b7280;
      text-align:center;
    }

    footer.site-footer{
      border-top:1px solid rgba(148,163,184,.5);
      margin-top:auto;
    }
    .site-footer .footer-inner{
      max-width:1100px;
      margin:0 auto;
      padding:14px 12px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:#6b7280;
    }
    .footer-nav{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .footer-nav a{
      color:#6b7280;
      text-decoration:none;
      font-size:12px;
    }
    .footer-nav a:hover{text-decoration:underline;}

    /* plan highlight uit querystring */
    #plan-note strong{font-weight:800;}
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">
        <img src="img/logo.png" alt="">
        <span class="brand-name">Vrijeplek</span><span class="brand-dot"></span>
      </a>
      <nav class="header-actions">
        <a class="nav-btn" href="waarom.html">Waarom Vrijeplek?</a>
        <a class="nav-btn" href="aanmelden.html" aria-current="page">Word lid</a>
        <a id="nav-login" class="nav-btn" href="login.html">Login</a>
        <a id="nav-mijn" class="nav-btn btn-green" href="dashboard.html" style="display:none;">Mijn Vrijeplek</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="signup-hero">
      <div class="wrap signup-grid">
        <!-- LINKERKANT: UITLEG -->
        <div class="signup-copy">
          <h1>Word lid van Vrijeplek in 2 stappen.</h1>
          <p class="lead">
            Eerst maak je <strong>gratis</strong> een account. Daarna kies je in je dashboard
            of je maandelijks of jaarlijks wil activeren. Je betaalt pas als je je plan activeert.
          </p>

          <div id="plan-note" class="plan-pill">
            <span>Stap 2-plannen:</span>
            <div>Maandelijks €19,95 • Jaarplan €180 (3 mnd gratis)</div>
          </div>

          <ul class="steps-list">
            <li><strong>Stap 1:</strong> vul hieronder je gegevens in en bevestig via e-mail.</li>
            <li><strong>Stap 2:</strong> log in, activeer je plan en zet je eerste vrije plekken online.</li>
            <li>Maandelijks opzegbaar. Geen commissie per boeking.</li>
          </ul>

          <p class="mini-note">
            Tip: gebruik hetzelfde e-mailadres als voor je facturatie, dan loopt alles netjes samen.
          </p>
        </div>

        <!-- RECHTERKANT: FORMULIER -->
        <div class="signup-card">
          <h2>Account aanmaken</h2>
          <p class="sub">Account is gratis. Abonnement kies en activeer je later in je dashboard.</p>

          <form id="signup-form" novalidate>
            <div class="two">
              <div class="field">
                <label for="name">Naam</label>
                <input id="name" type="text" required placeholder="Volledige naam">
              </div>
              <div class="field">
                <label for="company">Bedrijfsnaam</label>
                <input id="company" type="text" placeholder="Naam van je zaak">
              </div>
            </div>

            <div class="field">
              <label for="email">E-mail</label>
              <input id="email" type="email" required placeholder="naam@voorbeeld.be">
            </div>

            <div class="two">
              <div class="field">
                <label for="password">Wachtwoord</label>
                <input id="password" type="password" required minlength="6" placeholder="Min. 6 tekens">
              </div>
              <div class="field">
                <label for="password2">Herhaal wachtwoord</label>
                <input id="password2" type="password" required minlength="6" placeholder="Nogmaals wachtwoord">
              </div>
            </div>

            <div class="two">
              <div class="field">
                <label for="phone">Telefoon</label>
                <input id="phone" type="tel" placeholder="+32 ...">
              </div>
              <div class="field">
                <label for="btw">BTW-nummer</label>
                <input id="btw" type="text" placeholder="BE0123456789">
              </div>
            </div>

            <div class="two">
              <div class="field">
                <label for="cat">Categorie</label>
                <select id="cat" required>
                  <option value="">Kies</option>
                  <option value="horeca">Horeca</option>
                  <option value="wellness">Wellness</option>
                  <option value="zorg">Gezondheid</option>
                  <option value="events">Events</option>
                  <option value="poetsdiensten">Poetsdiensten</option>
                  <option value="ramenwasser">Ramenwasser</option>
                  <option value="dieren">Dieren</option>
                </select>
              </div>
              <div class="field">
                <label for="postcode">Postcode & gemeente</label>
                <input id="postcode" type="text" placeholder="3500 Hasselt">
              </div>
            </div>

            <div class="field">
              <label for="straat">Straat + nr.</label>
              <input id="straat" type="text" placeholder="Bergstraat 1">
            </div>

            <div class="field terms-row">
              <label class="terms-label">
                <input id="terms" type="checkbox" required>
                <span>Ik ga akkoord met de
                  <a href="voorwaarden.html" target="_blank">algemene voorwaarden</a>.
                </span>
              </label>
            </div>

            <button type="submit" class="btn">Account aanmaken</button>
            <div id="msg"></div>
            <p class="form-footnote">
              Na je registratie sturen we een bevestigingsmail. Daarna kun je inloggen en je abonnement activeren.
            </p>
          </form>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <p>© 2025 Vrijeplek. Alle rechten voorbehouden.</p>
      <nav class="footer-nav">
        <a href="voorwaarden.html">Algemene voorwaarden</a>
        <a href="#privacy">Privacy</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </footer>

  <!-- 1) Supabase UMD -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0/dist/umd/supabase.min.js"></script>

  <!-- 2) Config -->
  <script src="/js/config.js"></script>

  <!-- 3) Signup + nav + plan-highlight -->
  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('signup-form');
      const msg  = document.getElementById('msg');
      const planNote = document.getElementById('plan-note');
      const btnLogin = document.getElementById('nav-login');
      const btnMijn  = document.getElementById('nav-mijn');

      // Plan tonen op basis van ?plan=
      if (planNote) {
        const params = new URLSearchParams(window.location.search);
        const plan = params.get('plan');
        if (plan === 'monthly') {
          planNote.innerHTML = '<span>Gekozen plan:</span> <div><strong>Maandelijks</strong> €19,95 • later altijd om te zetten naar jaarplan.</div>';
        } else if (plan === 'yearly') {
          planNote.innerHTML = '<span>Gekozen plan:</span> <div><strong>Jaarplan</strong> €180 (3 mnd gratis) • voordeligste optie.</div>';
        }
      }

      // Wait for config to load
      function initSupabase() {
        return new Promise((resolve) => {
          if (window.VRIJEPLEK?.SUPABASE_URL && window.VRIJEPLEK?.SUPABASE_ANON_KEY) {
            resolve(createSupabaseClient());
            return;
          }

          window.addEventListener('vrijeplek-config-loaded', () => {
            resolve(createSupabaseClient());
          }, { once: true });

          setTimeout(() => resolve(createSupabaseClient()), 3000);
        });
      }

      function createSupabaseClient() {
        const SUPABASE_URL = window.VRIJEPLEK?.SUPABASE_URL || window.ENV?.SUPABASE_URL || '';
        const SUPABASE_ANON_KEY = window.VRIJEPLEK?.SUPABASE_ANON_KEY || window.ENV?.SUPABASE_ANON_KEY || '';

        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
          console.error('Supabase/config niet geladen');
          return null;
        }

        // Import createClient dynamically
        return import('https://esm.sh/@supabase/supabase-js@2').then(({ createClient }) => {
          return createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        });
      }

      initSupabase().then(clientPromise => {
        if (!clientPromise) {
          if (msg) msg.textContent = 'Configuratie fout. Herlaad de pagina.';
          return;
        }

        clientPromise.then(client => {
          if (!client) {
            if (msg) msg.textContent = 'Configuratie fout. Herlaad de pagina.';
            return;
          }

      // Nav-knoppen wisselen op basis van sessie
      async function toggleNav(){
        if (!btnLogin || !btnMijn) return;
        const { data:{ session } } = await client.auth.getSession();
        const loggedIn = !!session?.user;
        if (loggedIn) {
          btnLogin.style.display = 'none';
          btnMijn.style.display  = 'inline-flex';
        } else {
          btnLogin.style.display = 'inline-flex';
          btnMijn.style.display  = 'inline-flex';
          btnMijn.style.display  = 'none';
        }
      }
          toggleNav();
          client.auth.onAuthStateChange(() => toggleNav());

          // Signup handler
          if (!form || !msg) return;

          form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.className = '';
        msg.textContent = 'Even geduld…';

        const name  = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim().toLowerCase();
        const pass  = document.getElementById('password').value.trim();
        const pass2 = document.getElementById('password2').value.trim();

        if (pass !== pass2){
          msg.className='error';
          msg.textContent='Wachtwoorden komen niet overeen.';
          return;
        }
        if (!document.getElementById('terms').checked){
          msg.className='error';
          msg.textContent='Je moet akkoord gaan met de voorwaarden.';
          return;
        }

        try{
          const { error } = await client.auth.signUp({
            email,
            password: pass,
            options:{
              data:{
                display_name: name,
                bedrijf: document.getElementById('company').value.trim(),
                telefoon: document.getElementById('phone').value.trim(),
                btw: document.getElementById('btw').value.trim(),
                cat: document.getElementById('cat').value,
                straat: document.getElementById('straat').value.trim(),
                postcode: document.getElementById('postcode').value.trim()
              },
              emailRedirectTo: 'https://vrijeplek.be/bedankt.html'
            }
          });

          if (error) {
            msg.className='error';
            msg.textContent = error.message.includes('already')
              ? 'Er bestaat al een account met dit e-mailadres.'
              : 'Registratie mislukt: ' + error.message;
            return;
          }

          msg.className='ok';
          msg.textContent='Bevestigingsmail verstuurd. Controleer je inbox of spam.';
        } catch(err){
          console.error(err);
            msg.className='error';
            msg.textContent='Netwerkfout. Probeer opnieuw.';
          }
        });
        }).catch(err => {
          console.error('Supabase init error:', err);
          if (msg) msg.textContent = 'Fout bij initialiseren. Herlaad de pagina.';
        });
      }).catch(err => {
        console.error('Config load error:', err);
        if (msg) msg.textContent = 'Configuratie fout. Herlaad de pagina.';
      });
    });
  </script>
</body>
</html>
