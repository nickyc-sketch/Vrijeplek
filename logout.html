<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>Uitloggenâ€¦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<script src="/js/config.js"></script>
<script type="module">
(async function(){
  try{
    // Cookies wissen (best effort)
    try{
      document.cookie.split(';').forEach(function(c){
        var name = c.split('=')[0].trim();
        if(name){
          document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
        }
      });
    }catch{}

    // Supabase signout - use proper config
    (async function(){
      try{
        // Wait for config if needed
        let config = window.VRIJEPLEK;
        if (!config?.SUPABASE_URL || !config?.SUPABASE_ANON_KEY) {
          // Wait for config to load
          await new Promise((resolve) => {
            if (window.VRIJEPLEK?.SUPABASE_URL && window.VRIJEPLEK?.SUPABASE_ANON_KEY) {
              resolve();
              return;
            }
            window.addEventListener('vrijeplek-config-loaded', resolve, { once: true });
            setTimeout(resolve, 2000); // Timeout after 2 seconds
          });
          config = window.VRIJEPLEK;
        }
        
        if (config?.SUPABASE_URL && config?.SUPABASE_ANON_KEY) {
          const { createClient } = await import('https://esm.sh/@supabase/supabase-js@2');
          const supa = createClient(config.SUPABASE_URL, config.SUPABASE_ANON_KEY, {
            auth: { persistSession: true, storage: localStorage }
          });
          
          // Sign out from Supabase
          const { error } = await supa.auth.signOut();
          if (error) {
            console.error('Sign out error:', error);
          } else {
            console.log('Signed out successfully');
          }
        }
      }catch(e){
        console.error('Logout error:', e);
      }
      
      // Clear all storage
      try{ localStorage.clear(); }catch{}
      try{ sessionStorage.clear(); }catch{}
      
      // Redirect to login
      location.replace('login.html');
    })();
})();
</script>
</body>
</html>
