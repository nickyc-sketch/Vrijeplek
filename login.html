<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login — Vrijeplek</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=smurf6">
  <style>
    .site-header::after{content:"";position:absolute;inset:auto 0 0 0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.45),transparent);opacity:.6}
    .section-title{display:flex;align-items:center;gap:10px;justify-content:center;margin:8px auto 22px;color:var(--blue-900)}
    .section-title::before,.section-title::after{content:"";flex:1 1 100px;height:1px;background:linear-gradient(90deg,transparent,rgba(26,102,255,.25),transparent)}
    .form-grid{display:grid;grid-template-columns:1fr;gap:14px}
    .tiny-note{font-size:12px;color:#5b6b86}
    .under-links{display:flex;gap:12px;justify-content:center;font-size:14px}
    @media (min-width: 720px){ .form-grid{grid-template-columns:1fr 1fr} }
  </style>
</head>
<body>
  <div class="site">
    <header class="site-header">
      <div class="header-inner">
        <a href="index.html" class="brand" style="text-decoration:none;display:flex;align-items:center;gap:10px;">
          <img src="img/logo.png" alt="Vrijeplek logo" style="height:40px;" onerror="this.remove()">
          <span class="brand-name">Vrijeplek</span><span class="brand-dot"></span>
        </a>
        <nav class="header-actions">
          <a class="nav-btn" href="aanmelden.html">Word lid</a>
          <a class="nav-btn" href="login.html" aria-current="page">Login</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero" style="padding:56px 0 40px;text-align:center;">
        <div class="container hero-inner">
          <h1 class="section-title">Log in op je account</h1>
          <p style="max-width:700px;margin:0 auto 26px;color:#1f2a44;">Gebruik je e-mailadres en wachtwoord.</p>

          <div class="search-wrap" style="max-width:620px; padding:18px; margin-inline:auto;">
            <div class="card-head">
              <h2>Beveiligde login</h2>
              <span class="badge"><span class="badge-dot"></span> SSL actief</span>
            </div>

            <form id="login-form" class="form-grid" novalidate>
              <div class="field" style="grid-column:1 / -1;">
                <label for="login-email">E-mailadres</label>
                <input id="login-email" type="email" class="input" required autocomplete="email">
              </div>
              <div class="field" style="grid-column:1 / -1;">
                <label for="login-password">Wachtwoord</label>
                <input id="login-password" type="password" class="input" required autocomplete="current-password">
              </div>
              <div class="field" style="grid-column:1 / -1;display:flex;align-items:center;gap:8px;">
                <input id="remember" type="checkbox" checked>
                <label for="remember">Ingelogd blijven</label>
              </div>

              <div class="submit-zone" style="grid-column:1 / -1;flex-direction:column;gap:10px;">
                <button type="submit" class="btn" style="min-width:220px;height:46px;">Inloggen</button>
                <div id="login-msg" class="tiny-note"></div>
                <div class="under-links">
                  <a href="wachtwoord-vergeten.html" class="text-link">Wachtwoord vergeten?</a>
                  <span>•</span>
                  <a href="aanmelden.html" class="text-link">Account aanmaken</a>
                </div>
              </div>
            </form>
          </div>

        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <p>© 2025 Vrijeplek. Alle rechten voorbehouden.</p>
        <nav class="footer-nav">
          <a href="voorwaarden.html">Algemene voorwaarden</a>
          <a href="#privacy">Privacy</a>
          <a href="#contact">Contact</a>
        </nav>
      </div>
    </footer>
  </div>

  <script src="/js/config.js"></script>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const SUPABASE_URL = window.VRIJEPLEK?.SUPABASE_URL || 'https://xdmrikvxyeebeusnbzav.supabase.co';
    const SUPABASE_ANON_KEY = window.VRIJEPLEK?.SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkbXJpa3Z4eWVlYmV1c25iemF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4Mjc5MjgsImV4cCI6MjA3NzQwMzkyOH0.WmOMDZoFSk9RwQE1lT9yUuOCwsMjZbKVQrtNpBflpB0';

    // Gebruik altijd localStorage, zodat dashboard dezelfde sessie ziet
    const supa = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, storage: localStorage }
    });

    // Als er al een sessie is, meteen naar dashboard
    {
      const { data: { session } } = await supa.auth.getSession();
      if (session) window.location.href = '/dashboard.html';
    }

    const form   = document.getElementById('login-form');
    const email  = document.getElementById('login-email');
    const pass   = document.getElementById('login-password');
    const msg    = document.getElementById('login-msg');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (!email.value.trim() || !pass.value) {
        msg.textContent = 'Vul e-mailadres en wachtwoord in.'; return;
      }
      msg.textContent = 'Aan het inloggen…';

      const { error } = await supa.auth.signInWithPassword({
        email: email.value.trim(),
        password: pass.value
      });

      if (error) { msg.textContent = error.message || 'Login mislukt.'; return; }

      // Sessie bestaat nu in localStorage → door naar dashboard
      window.location.href = '/dashboard.html';
    });
  </script>
</body>
</html>
