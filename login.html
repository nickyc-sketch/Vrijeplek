<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login — Vrijeplek</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css?v=smurf6">

  <style>
    :root{
      --o1:#1a66ff;
      --o2:#0056ff;
      --ink:#e5e7eb;
      --muted:#94a3b8;
      --danger:#e23b3b;
      --ok:#10b981;
    }

    *{box-sizing:border-box;}

    html,body{
      height:100%;
    }

    body{
      margin:0;
      font-family:"Poppins",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--ink);
      background:
        radial-gradient(120% 140% at 0% 0%, #003b84 0, transparent 60%),
        radial-gradient(120% 140% at 100% 0%, #00a0ff 0, transparent 55%),
        radial-gradient(160% 160% at 50% 120%, #021428 0, #020617 55%);
      background-attachment:fixed;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

    .site{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

   
    .site-header{
      position:sticky;
      top:0;
      z-index:40;
      backdrop-filter:blur(26px);
      background:linear-gradient(180deg,rgba(2,6,23,.94),rgba(2,6,23,.8),rgba(2,6,23,0));
      border-bottom:1px solid rgba(148,163,184,.35);
    }
    .header-inner{
      max-width:1120px;
      margin:0 auto;
      padding:.9rem 1.5rem .8rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1.25rem;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:.75rem;
      text-decoration:none;
      color:#e5edff;
      margin-right:auto;
    }
    .brand-mark{
      width:34px;
      height:34px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 20%, #ffffff 0, #b3e0ff 18%, transparent 40%),
        radial-gradient(circle at 80% 80%, #0f5bff 0, #001d5c 55%);
      box-shadow:0 0 0 1px rgba(255,255,255,.1),0 10px 30px rgba(0,0,0,.45);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.05rem;
      font-weight:700;
      color:#fff;
    }
    .brand-wordmark{
      display:flex;
      flex-direction:column;
      gap:0;
      line-height:1.1;
    }
    .brand-wordmark span:first-child{
      font-size:.98rem;
      font-weight:700;
      letter-spacing:.04em;
      text-transform:uppercase;
    }
    .brand-wordmark span:last-child{
      font-size:.72rem;
      font-weight:500;
      color:rgba(148,163,184,.9);
      text-transform:lowercase;
    }

    .header-actions{
      display:flex;
      align-items:center;
      gap:.6rem;
      flex-wrap:wrap;
    }
    .nav-btn{
      border-radius:999px;
      padding:.4rem .9rem;
      font-size:.8rem;
      border:1px solid rgba(148,163,184,.6);
      background:rgba(15,23,42,.6);
      color:#e5edff;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.35rem;
      backdrop-filter:blur(10px);
      text-decoration:none;
      font-weight:500;
      white-space:nowrap;
    }
    .nav-btn:hover{
      background:rgba(15,23,42,.9);
      border-color:rgba(191,219,254,.9);
    }
    .nav-btn-primary{
      border:none;
      background:linear-gradient(135deg,var(--o1),var(--o2));
      color:#fff;
      box-shadow:0 10px 24px rgba(37,99,235,.55);
    }
    .nav-btn-primary:hover{
      box-shadow:0 14px 32px rgba(37,99,235,.7);
      transform:translateY(-1px);
    }
    .nav-btn[aria-current="page"]{
      border-color:rgba(191,219,254,.9);
      background:rgba(15,23,42,.85);
    }

    @media(max-width:720px){
      .header-inner{
        padding:.75rem 1rem;
        gap:.6rem;
      }
      .header-actions{
        gap:.35rem;
      }
      .nav-btn{
        font-size:.76rem;
        padding:.35rem .75rem;
      }
    }

    /* MAIN LAYOUT */

    main.site-main{
      flex:1;
      display:flex;
      justify-content:center;
      padding:1.6rem 1.4rem 2.4rem;
    }
    .auth-shell{
      width:100%;
      max-width:1120px;
      margin:0 auto;
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,0.9fr);
      gap:2.1rem;
      align-items:center;
    }
    @media(max-width:960px){
      .auth-shell{
        grid-template-columns:1fr;
        gap:1.75rem;
      }
    }

    .auth-copy h1{
      margin:0 0 .6rem;
      font-size:clamp(1.7rem,2.7vw,2.1rem);
      color:#e5e7eb;
    }
    .auth-copy p.lead{
      margin:0 0 .9rem;
      font-size:.9rem;
      color:var(--muted);
      max-width:460px;
    }
    .auth-list{
      list-style:none;
      padding:0;
      margin:.4rem 0 0;
      font-size:.86rem;
      color:rgba(226,232,240,.9);
    }
    .auth-list li{
      display:flex;
      align-items:flex-start;
      gap:.5rem;
      margin:.2rem 0;
    }
    .auth-list li span.bullet{
      width:18px;
      height:18px;
      border-radius:999px;
      background:rgba(22,163,74,.18);
      border:1px solid rgba(34,197,94,.6);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:.7rem;
      color:#4ade80;
      flex-shrink:0;
      margin-top:.06rem;
    }
    .auth-note{
      margin-top:.8rem;
      font-size:.78rem;
      color:rgba(148,163,184,.95);
    }
    .auth-note a{
      color:#bfdbfe;
      text-decoration:none;
    }
    .auth-note a:hover{text-decoration:underline;}

    /* LOGIN CARD */

    .auth-card{
      position:relative;
    }

    .card{
      background:rgba(15,23,42,.88);
      border-radius:1.25rem;
      padding:1.35rem 1.5rem 1.4rem;
      border:1px solid rgba(148,163,184,.4);
      box-shadow:0 22px 60px rgba(15,23,42,.9);
      color:#e5e7eb;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(circle at 0 0,rgba(59,130,246,.15),transparent 60%),
        radial-gradient(circle at 100% 0,rgba(56,189,248,.15),transparent 55%);
      opacity:.8;
      pointer-events:none;
    }
    .card > *{position:relative; z-index:1;}

    .card-glass{
      background:linear-gradient(135deg,rgba(15,23,42,.97),rgba(15,23,42,.92));
      border-color:rgba(191,219,254,.6);
    }

    .card-header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.8rem;
      margin-bottom:.9rem;
    }
    .card-title{
      margin:0;
      font-size:1.05rem;
    }
    .card-subtitle{
      margin:.1rem 0 0;
      font-size:.78rem;
      color:rgba(148,163,184,.9);
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size:.72rem;
      padding:.2rem .55rem;
      border-radius:999px;
      border:1px solid rgba(34,197,94,.5);
      background:rgba(22,163,74,.1);
      color:#bbf7d0;
      white-space:nowrap;
    }
    .badge-dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background:radial-gradient(circle at 50% 50%, #4ade80 0,#22c55e 50%,#166534 100%);
      box-shadow:0 0 0 4px rgba(34,197,94,.28);
    }

    .form-grid{
      display:flex;
      flex-direction:column;
      gap:.65rem;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:.28rem;
    }
    .field label{
      font-size:.84rem;
      font-weight:500;
      color:rgba(226,232,240,.9);
    }
    .field input{
      border-radius:.75rem;
      border:1px solid rgba(148,163,184,.65);
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
      padding:.55rem .75rem;
      font-size:.9rem;
      outline:none;
      transition:.14s;
    }
    .field input::placeholder{color:rgba(148,163,184,.85);}
    .field input:focus{
      border-color:rgba(191,219,254,.95);
      box-shadow:0 0 0 1px rgba(129,140,248,.9);
    }

    .remember-row{
      display:flex;
      align-items:center;
      gap:.4rem;
      font-size:.8rem;
      color:rgba(148,163,184,.9);
      margin-top:.15rem;
    }
    .remember-row input{
      accent-color:var(--o1);
      width:14px;height:14px;
    }

    .submit-zone{
      margin-top:.6rem;
      display:flex;
      flex-direction:column;
      gap:.6rem;
    }

    .btn-main{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.35rem;
      width:100%;
      border-radius:999px;
      border:none;
      cursor:pointer;
      padding:.7rem 1.2rem;
      font-size:.9rem;
      font-weight:600;
      background:linear-gradient(135deg,var(--o1),var(--o2));
      color:#fff;
      box-shadow:0 14px 32px rgba(37,99,235,.55);
      transition:.18s ease;
    }
    .btn-main:hover{
      transform:translateY(-1px);
      box-shadow:0 18px 40px rgba(37,99,235,.7);
    }
    .btn-main:active{
      transform:translateY(0);
      box-shadow:0 10px 28px rgba(37,99,235,.6);
    }

    #login-msg{
      min-height:18px;
      font-size:.8rem;
      text-align:center;
      color:rgba(148,163,184,.95);
    }
    #login-msg.error{
      color:var(--danger);
      font-weight:600;
    }

    .under-links{
      display:flex;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      gap:.5rem;
      font-size:.8rem;
      color:rgba(148,163,184,.9);
    }
    .under-links a{
      color:#bfdbfe;
      text-decoration:none;
    }
    .under-links a:hover{text-decoration:underline;}

    footer.site-footer{
      border-top:1px solid rgba(30,64,175,.8);
      background:rgba(2,6,23,.96);
      margin-top:auto;
    }
    .site-footer .footer-inner{
      max-width:1120px;
      margin:0 auto;
      padding:.8rem 1.5rem 1rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.75rem;
      font-size:.74rem;
      color:rgba(148,163,184,.9);
    }
    .footer-nav{
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
    }
    .footer-nav a{
      color:rgba(148,163,184,.9);
      text-decoration:none;
    }
    .footer-nav a:hover{text-decoration:underline;}

    @media(max-width:720px){
      main.site-main{
        padding:1.2rem 1rem 2rem;
      }
      .card{
        padding:1.15rem 1.1rem 1.2rem;
      }
      .site-footer .footer-inner{
        padding:.8rem 1rem 1rem;
        flex-direction:column-reverse;
        align-items:flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="site">
    <header class="site-header">
      <div class="header-inner">
        <a href="index.html" class="brand" aria-label="Terug naar Vrijeplek home">
          <div class="brand-mark">V</div>
          <div class="brand-wordmark">
            <span>vrijeplek</span>
            <span>last minute afspreken</span>
          </div>
        </a>
        <nav class="header-actions">
          <a class="nav-btn" href="waarom.html">Waarom Vrijeplek?</a>
          <a id="nav-login" class="nav-btn" href="login.html" aria-current="page">Login</a>
          <a id="nav-mijn" class="nav-btn nav-btn-primary" href="dashboard.html" style="display:none;">Mijn Vrijeplek</a>
        </nav>
      </div>
    </header>

    <main class="site-main">
      <section class="auth-shell">
        <div class="auth-copy">
          <h1>Log in op je Vrijeplek-dashboard</h1>
          <p class="lead">
            Beheer je vrije momenten, volg aanvragen op en hou je agenda strak zonder
            eindeloze telefoontjes of berichtjes.
          </p>
          <ul class="auth-list">
            <li>
              <span class="bullet">✓</span>
              <span>Publiceer last-minute vrije momenten in enkele seconden.</span>
            </li>
            <li>
              <span class="bullet">✓</span>
              <span>Bevestig of weiger aanvragen met één klik.</span>
            </li>
            <li>
              <span class="bullet">✓</span>
              <span>Pas je bedrijfs- en facturatiegegevens aan in je eigen dashboard.</span>
            </li>
          </ul>
          <p class="auth-note">
            Nog geen account? <a href="waarom.html">Lees waarom en maak je lid!
          </p>
        </div>

        <div class="auth-card">
          <div class="card card-glass">
            <div class="card-header-row">
              <div>
                <h2 class="card-title">Beveiligde login</h2>
                <p class="card-subtitle">Log in met je e-mailadres en wachtwoord.</p>
              </div>
              <span class="badge">
                <span class="badge-dot"></span>
                SSL actief
              </span>
            </div>

            <form id="login-form" class="form-grid" novalidate>
              <div class="field">
                <label for="login-email">E-mailadres</label>
                <input id="login-email" type="email" required autocomplete="email" placeholder="naam@voorbeeld.be">
              </div>
              <div class="field">
                <label for="login-password">Wachtwoord</label>
                <input id="login-password" type="password" required autocomplete="current-password" placeholder="Je wachtwoord">
              </div>
              <div class="field">
                <div class="remember-row">
                  <input id="remember" type="checkbox" checked>
                  <label for="remember">Ingelogd blijven op dit toestel</label>
                </div>
              </div>

              <div class="submit-zone">
                <button type="submit" class="btn-main">
                  Inloggen
                </button>
                <div id="login-msg"></div>
                <div class="under-links">
                  <a href="wachtwoord-vergeten.html">Wachtwoord vergeten?</a>
                  <span>•</span>
                  <a href="waarom.html">Nog geen account? Lees waarom en maak je lid!/a>
                </div>
              </div>
            </form>
          </div>
        </div>

      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <p>© 2025 Vrijeplek. Alle rechten voorbehouden.</p>
        <nav class="footer-nav">
          <a href="voorwaarden.html">Algemene voorwaarden</a>
          <a href="#privacy">Privacy</a>
          <a href="#contact">Contact</a>
        </nav>
      </div>
    </footer>
  </div>

  <script src="/js/config.js"></script>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    // Wait for config to load
    function initSupabase() {
      return new Promise((resolve) => {
        // If config is already loaded, proceed immediately
        if (window.VRIJEPLEK?.SUPABASE_URL && window.VRIJEPLEK?.SUPABASE_ANON_KEY) {
          resolve(createSupabaseClient());
          return;
        }

        // Otherwise wait for config-loaded event
        window.addEventListener('vrijeplek-config-loaded', () => {
          resolve(createSupabaseClient());
        }, { once: true });

        // Timeout after 3 seconds
        setTimeout(() => {
          resolve(createSupabaseClient());
        }, 3000);
      });
    }

    function createSupabaseClient() {
      const SUPABASE_URL = window.VRIJEPLEK?.SUPABASE_URL || window.ENV?.SUPABASE_URL || '';
      const SUPABASE_ANON_KEY = window.VRIJEPLEK?.SUPABASE_ANON_KEY || window.ENV?.SUPABASE_ANON_KEY || '';

      if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
        console.error('Supabase credentials not configured. Check Netlify environment variables.');
        const msg = document.getElementById('login-msg');
        if (msg) {
          msg.className = 'error';
          msg.textContent = 'Configuratiefout: Supabase credentials ontbreken. Neem contact op met de beheerder.';
        }
        return null;
      }

      return createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
        auth: { persistSession: true, autoRefreshToken: true, storage: localStorage }
      });
    }

    // On load: zorg dat "Mijn Vrijeplek" verstopt is tot we weten of er een sessie is
    (function() {
      const btnMijn = document.getElementById('nav-mijn');
      const btnLogin = document.getElementById('nav-login');
      if (btnMijn) {
        btnMijn.style.setProperty('display', 'none', 'important');
        btnMijn.style.setProperty('visibility', 'hidden', 'important');
        btnMijn.style.setProperty('opacity', '0', 'important');
        btnMijn.style.setProperty('pointer-events', 'none', 'important');
      }
      if (btnLogin) {
        btnLogin.style.setProperty('display', 'inline-flex', 'important');
        btnLogin.style.setProperty('visibility', 'visible', 'important');
      }
    })();

    const supaPromise = initSupabase();

    supaPromise.then(async (supa) => {
      if (!supa) {
        const btnLogin = document.getElementById('nav-login');
        const btnMijn = document.getElementById('nav-mijn');
        if (btnLogin) btnLogin.style.display = 'inline-flex';
        if (btnMijn) btnMijn.style.display = 'none';
        return;
      }

      const btnLogin = document.getElementById('nav-login');
      const btnMijn  = document.getElementById('nav-mijn');

      if (!btnLogin || !btnMijn) {
        console.warn('Nav buttons not found');
        return;
      }

      async function toggleNav(){
        try {
          const { data, error } = await supa.auth.getSession();

          if (error) {
            console.error('Session check error:', error);
            btnLogin.style.display = 'inline-flex';
            btnLogin.style.visibility = 'visible';
            btnMijn.style.display = 'none';
            btnMijn.style.visibility = 'hidden';
            return;
          }

          const hasValidSession = !!(data?.session?.user?.id);
          const sessionExpired = data?.session?.expires_at
            ? (new Date(data.session.expires_at * 1000) < new Date())
            : false;

          const loggedIn = hasValidSession && !sessionExpired;
          console.log('Session check - logged in:', loggedIn, 'User:', data?.session?.user?.email);

          if (loggedIn){
            btnLogin.style.display = 'none';
            btnLogin.style.visibility = 'hidden';
            btnMijn.style.display = 'inline-flex';
            btnMijn.style.visibility = 'visible';
          } else {
            btnLogin.style.display = 'inline-flex';
            btnLogin.style.visibility = 'visible';
            btnMijn.style.display = 'none';
            btnMijn.style.visibility = 'hidden';
          }
        } catch (err) {
          console.error('Toggle nav error:', err);
          btnLogin.style.display = 'inline-flex';
          btnLogin.style.visibility = 'visible';
          btnMijn.style.display = 'none';
          btnMijn.style.visibility = 'hidden';
        }
      }

      // Initial check
      await toggleNav();

      // Listen for auth state changes
      supa.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event, 'Has session:', !!session);
        toggleNav();
      });

      const form   = document.getElementById('login-form');
      const email  = document.getElementById('login-email');
      const pass   = document.getElementById('login-password');
      const msg    = document.getElementById('login-msg');

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const cleanEmail = email.value.trim().toLowerCase();

        if (!cleanEmail || !pass.value) {
          msg.className = 'error';
          msg.textContent = 'Vul e-mailadres en wachtwoord in.';
          return;
        }
        msg.className = '';
        msg.textContent = 'Aan het inloggen…';

        const { error } = await supa.auth.signInWithPassword({
          email: cleanEmail,
          password: pass.value
        });

        if (error) {
          msg.className = 'error';
          msg.textContent = error.message || 'Login mislukt.';
          return;
        }

        // Succes → nav updaten en doorsturen
        if (typeof toggleNav === 'function') {
          await toggleNav();
        }
        const target = '/dashboard.html?email=' + encodeURIComponent(cleanEmail);
        setTimeout(() => {
          window.location.href = target;
        }, 100);
      });
    }).catch(err => {
      console.error('Failed to initialize Supabase:', err);
      const btnLogin = document.getElementById('nav-login');
      const btnMijn = document.getElementById('nav-mijn');
      if (btnLogin) {
        btnLogin.style.display = 'inline-flex';
        btnLogin.style.visibility = 'visible';
      }
      if (btnMijn) {
        btnMijn.style.display = 'none';
        btnMijn.style.visibility = 'hidden';
      }
      const msg = document.getElementById('login-msg');
      if (msg) {
        msg.className = 'error';
        msg.textContent = 'Fout bij initialiseren. Herlaad de pagina.';
      }
    });
  </script>
</body>
</html>
