<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vrijeplek — Last minute? Zoek een afspraak!</title>

  <!-- Google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/index.css?v=4">
  <style>
    /* Tijdelijke homepage-fixes zodat alles weer leesbaar en netjes is */

    /* Blauwe knoppen (Zoek, Zoek flexijobs, …) */
    .btn-primary,
    .btn-primary.btn-primary-small,
    .search-btn,
    #flex-search-btn {
      display: inline-block;
      padding: 0.7rem 1.4rem;
      border-radius: 4px;
      border: none;
      background: #1b75d0; /* kies hier je exacte blauw indien nodig */
      color: #fff;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      cursor: pointer;
    }

    .btn-primary.btn-primary-small {
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
    }

    .btn-primary:hover,
    .search-btn:hover,
    #flex-search-btn:hover {
      filter: brightness(1.1);
    }

    /* 'Wat zoek je / Waar / Vanaf / Tot / Categorie' + Flexijobs-labels */
    .search .field label,
    .flex-field label {
      color: #fff;
      font-weight: 600;
    }

    /* Footer-tekst en links wit i.p.v. paars */
    .site-footer,
    .site-footer a {
      color: #fff;
    }

    .site-footer a {
      text-decoration: none;
      font-weight: 500;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="site">

    <!-- HEADER -->
    <header class="site-header">
      <div class="header-inner">
        <a class="brand" href="/" aria-label="Vrijeplek home">
          <div class="brand-mark">V</div>
          <div class="brand-wordmark">
            <span>vrijeplek</span>
            <span>last minute afspreken</span>
          </div>
        </a>

        <nav class="header-actions">
          <a class="nav-btn" href="/waarom">Waarom Vrijeplek?</a>
          <a class="nav-btn" href="/login" id="nav-login">Login</a>
          <a class="nav-btn btn-green" href="/dashboard" id="nav-mijn" style="display:none;">Mijn Vrijeplek</a>
        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <section class="main-grid">
        <div class="page-container">

          <!-- FLEXIJOBS (links op desktop — onderaan op mobiel) -->
          <aside class="flex-panel" id="flex-panel">
            <div class="flex-badge-top">Zie ook</div>
            <h2 class="flex-title">Flexijobs in jouw buurt</h2>
            <p class="flex-sub">
              Werk je graag bij als flexi? Bekijk welke zaken nu iemand zoeken.
            </p>

            <div class="flex-field">
              <label for="flex-loc">Waar?</label>
              <input id="flex-loc" type="text" placeholder="Stad, regio…">
            </div>
            <div class="flex-field">
              <label for="flex-cat">Sector</label>
              <select id="flex-cat">
                <option value="">Alle sectoren</option>
                <option value="horeca">Horeca</option>
                <option value="wellness">Wellness</option>
                <option value="zorg">Gezondheid</option>
                <option value="events">Events</option>
                <option value="huishoudhulp">Huishoudhulp</option>
                <option value="ramenwasser">Ramenwasser</option>
                <option value="dieren">Dieren</option>
                <option value="bouw">Bouw & renovatie</option>
              </select>
            </div>

            <button type="button" class="btn-primary btn-primary-small" id="flex-search-btn">
              Zoek flexijobs
            </button>

            <div id="flex-status" class="flex-status"></div>
            <div id="flex-list" class="flex-list"></div>
          </aside>

          <!-- MIDDENZOEKER -->
          <div class="search-column">

            <!-- Categorie bollen -->
            <section class="cat-dots">
              <ul class="cat-dots-row">
                <li><a class="catdot" data-cat="horeca" href="#zoeken"><img src="img/cat-horeca.jpg"><span>Horeca</span></a></li>
                <li><a class="catdot" data-cat="wellness" href="#zoeken"><img src="img/cat-wellness.jpg"><span>Wellness</span></a></li>
                <li><a class="catdot" data-cat="zorg" href="#zoeken"><img src="img/cat-gezondheid.jpg"><span>Gezondheid</span></a></li>
                <li><a class="catdot" data-cat="events" href="#zoeken"><img src="img/cat-events.jpg"><span>Events</span></a></li>
                <li><a class="catdot" data-cat="huishoudhulp" href="#zoeken"><img src="img/cat-huishoudhulp.jpg"><span>Huishoudhulp</span></a></li>
                <li><a class="catdot" data-cat="ramenwasser" href="#zoeken"><img src="img/cat-ramenwasser.jpg"><span>Ramenwasser</span></a></li>
                <li><a class="catdot" data-cat="dieren" href="#zoeken"><img src="img/cat-dieren.jpg"><span>Dieren</span></a></li>
                <li><a class="catdot" data-cat="bouw" href="#zoeken"><img src="img/cat-bouw.jpg"><span>Bouw & renovatie</span></a></li>
              </ul>
            </section>

            <!-- Zoekformulier -->
            <section class="search-wrap" id="zoeken">
              <form class="search" id="form">
                <div class="field">
                  <label for="q">Wat zoek je?</label>
                  <input id="q" name="q" type="text" placeholder="Bedrijf, trefwoord…">
                </div>
                <div class="field">
                  <label for="loc">Waar?</label>
                  <input id="loc" name="loc" type="text" placeholder="Stad, regio…">
                </div>
                <div class="field">
                  <label for="from">Vanaf</label>
                  <input id="from" name="from" type="date">
                </div>
                <div class="field">
                  <label for="to">Tot</label>
                  <input id="to" name="to" type="date">
                </div>
                <div class="field">
                  <label for="cat">Categorie</label>
                  <select id="cat" name="cat">
                    <option value="">Alle</option>
                    <option value="horeca">Horeca</option>
                    <option value="wellness">Wellness</option>
                    <option value="zorg">Gezondheid</option>
                    <option value="events">Events</option>
                    <option value="huishoudhulp">Huishoudhulp</option>
                    <option value="ramenwasser">Ramenwasser</option>
                    <option value="dieren">Dieren</option>
                    <option value="bouw">Bouw & renovatie</option>
                  </select>
                </div>
                <button type="submit" class="btn-primary search-btn">Zoek</button>
              </form>
            </section>

            <!-- Resultaten -->
            <section class="results" id="results" hidden>
              <div class="results-inner">
                <div class="results-head">
                  <h2 id="results-title">Vrije plekken</h2>
                  <div class="results-meta" id="results-meta">&nbsp;</div>
                </div>

                <div id="booking-msg"></div>
                <div id="results-list" class="results-list"></div>
              </div>
            </section>

          </div>

        </div> <!-- /page-container -->
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="footer-inner">
        <span>© <span id="year"></span> Vrijeplek.be — Last minute afspraken, netjes geregeld.</span>
        <nav class="footer-nav">
          <a href="/voorwaarden.html">Algemene voorwaarden</a>
          <a href="/waarom">Waarom Vrijeplek?</a>
        </nav>
      </div>
    </footer>

  </div> <!-- /site -->

<script src="/js/config.js"></script>
<script src="/js/index-logic.js?v=4"></script>
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  // Zelfde supabase-init als op loginpagina
  function initSupabase() {
    return new Promise((resolve) => {
      // Als config al geladen is → direct client maken
      if (window.VRIJEPLEK?.SUPABASE_URL && window.VRIJEPLEK?.SUPABASE_ANON_KEY) {
        resolve(createSupabaseClient());
        return;
      }

      // Anders wachten op het event van config.js
      window.addEventListener('vrijeplek-config-loaded', () => {
        resolve(createSupabaseClient());
      }, { once: true });

      // Fallback na 3 seconden
      setTimeout(() => {
        resolve(createSupabaseClient());
      }, 3000);
    });
  }

  function createSupabaseClient() {
    const SUPABASE_URL =
      window.VRIJEPLEK?.SUPABASE_URL ||
      window.ENV?.SUPABASE_URL || '';
    const SUPABASE_ANON_KEY =
      window.VRIJEPLEK?.SUPABASE_ANON_KEY ||
      window.ENV?.SUPABASE_ANON_KEY || '';

    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
      console.error('Supabase credentials niet geconfigureerd (homepage).');
      return null;
    }

    return createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, storage: localStorage }
    });
  }

  // Initieel: “Mijn Vrijeplek” verstoppen tot we weten of er een sessie is
  (function () {
    const btnMijn  = document.getElementById('nav-mijn');
    const btnLogin = document.getElementById('nav-login');

    if (btnMijn) {
      btnMijn.style.setProperty('display', 'none', 'important');
      btnMijn.style.setProperty('visibility', 'hidden', 'important');
      btnMijn.style.setProperty('opacity', '0', 'important');
      btnMijn.style.setProperty('pointer-events', 'none', 'important');
    }
    if (btnLogin) {
      btnLogin.style.setProperty('display', 'inline-flex', 'important');
      btnLogin.style.setProperty('visibility', 'visible', 'important');
    }
  })();

  const supaPromise = initSupabase();

  supaPromise.then(async (supa) => {
    const btnLogin = document.getElementById('nav-login');
    const btnMijn  = document.getElementById('nav-mijn');

    if (!btnLogin || !btnMijn) {
      console.warn('Nav-buttons niet gevonden op homepage.');
      return;
    }

    if (!supa) {
      // Geen Supabase → dan gewoon Login tonen
      btnLogin.style.display = 'inline-flex';
      btnLogin.style.visibility = 'visible';
      btnMijn.style.display = 'none';
      btnMijn.style.visibility = 'hidden';
      return;
    }

    async function toggleNav() {
      try {
        const { data, error } = await supa.auth.getSession();

        if (error) {
          console.error('Session check error (index):', error);
          btnLogin.style.display = 'inline-flex';
          btnLogin.style.visibility = 'visible';
          btnMijn.style.display = 'none';
          btnMijn.style.visibility = 'hidden';
          return;
        }

        const session = data?.session || null;
        const hasValidSession = !!(session?.user?.id);
        const sessionExpired = session?.expires_at
          ? (new Date(session.expires_at * 1000) < new Date())
          : false;

        const loggedIn = hasValidSession && !sessionExpired;

        if (loggedIn) {
          // Ingelogd → groene “Mijn Vrijeplek” tonen
          btnLogin.style.display = 'none';
          btnLogin.style.visibility = 'hidden';
          btnMijn.style.display = 'inline-flex';
          btnMijn.style.visibility = 'visible';
        } else {
          // Niet ingelogd → gewone Login tonen
          btnLogin.style.display = 'inline-flex';
          btnLogin.style.visibility = 'visible';
          btnMijn.style.display = 'none';
          btnMijn.style.visibility = 'hidden';
        }
      } catch (err) {
        console.error('Toggle nav error (index):', err);
        btnLogin.style.display = 'inline-flex';
        btnLogin.style.visibility = 'visible';
        btnMijn.style.display = 'none';
        btnMijn.style.visibility = 'hidden';
      }
    }

    // Eerste check bij load
    await toggleNav();

    // Luisteren naar wijzigingen in login‑status
    supa.auth.onAuthStateChange(() => {
      toggleNav();
    });
  }).catch((err) => {
    console.error('Failed to initialize Supabase op index:', err);
    const btnLogin = document.getElementById('nav-login');
    const btnMijn  = document.getElementById('nav-mijn');
    if (btnLogin) {
      btnLogin.style.display = 'inline-flex';
      btnLogin.style.visibility = 'visible';
    }
    if (btnMijn) {
      btnMijn.style.display = 'none';
      btnMijn.style.visibility = 'hidden';
    }
  });
</script>
</body>
</html>
