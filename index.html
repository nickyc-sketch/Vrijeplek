<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vrijeplek — Last minute? Zoek een afspraak!</title>

  <!-- Google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/index.css?v=6">
  <style>
    

   
    .btn-primary,
    .btn-primary.btn-primary-small,
    .search-btn,
    #flex-search-btn {
      display: inline-block;
      padding: 0.7rem 1.4rem;
      border-radius: 4px;
      border: none;
      background: #1b75d0; 
      color: #fff;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      cursor: pointer;
    }

    .btn-primary.btn-primary-small {
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
    }

    .btn-primary:hover,
    .search-btn:hover,
    #flex-search-btn:hover {
      filter: brightness(1.1);
    }

    
    .search .field label,
    .flex-field label {
      color: #fff;
      font-weight: 600;
    }

    /* Footer-tekst en links wit i.p.v. paars */
    .site-footer,
    .site-footer a {
      color: #fff;
    }

    .site-footer a {
      text-decoration: none;
      font-weight: 500;
    }

    .site-footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="site">

    <!-- HEADER -->
    <header class="site-header">
      <div class="header-inner">
        <a class="brand" href="/" aria-label="Vrijeplek home">
          <div class="brand-mark">V</div>
          <div class="brand-wordmark">
            <span>vrijeplek</span>
            <span>last minute afspreken</span>
          </div>
        </a>

        <nav class="header-actions">
          <a class="nav-btn" href="/waarom">Waarom Vrijeplek?</a>
          <a class="nav-btn" href="/login" id="nav-login">Login</a>
          <a class="nav-btn btn-green" href="/dashboard.html" id="nav-mijn" style="display:none;">Mijn Vrijeplek</a>
        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <section class="main-grid">
        <div class="page-container">

          <!-- FLEXIJOBS (links op desktop — onderaan op mobiel) -->
          <aside class="flex-panel" id="flex-panel">
            <div class="flex-badge-top">Zie ook</div>
            <h2 class="flex-title">Flexijobs in jouw buurt</h2>
            <p class="flex-sub">
              Werk je graag bij als flexi? Bekijk welke zaken nu iemand zoeken.
            </p>

            <div class="flex-field">
              <label for="flex-loc">Waar?</label>
              <input id="flex-loc" type="text" placeholder="Stad, regio…">
            </div>
            <div class="flex-field">
              <label for="flex-cat">Sector</label>
              <select id="flex-cat">
                <option value="">Alle sectoren</option>
                <option value="horeca">Horeca</option>
                <option value="wellness">Wellness</option>
                <option value="zorg">Gezondheid</option>
                <option value="events">Events</option>
                <option value="huishoudhulp">Huishoudhulp</option>
                <option value="ramenwasser">Ramenwasser</option>
                <option value="dieren">Dieren</option>
                <option value="bouw">Bouw & renovatie</option>
              </select>
            </div>

            <button type="button" class="btn-primary btn-primary-small" id="flex-search-btn">
              Zoek flexijobs
            </button>

            <div id="flex-status" class="flex-status"></div>
            <div id="flex-list" class="flex-list"></div>
          </aside>

          <!-- MIDDENZOEKER -->
          <div class="search-column">

            <!-- Categorie bollen -->
            <section class="cat-dots">
              <ul class="cat-dots-row">
                <li><a class="catdot" data-cat="horeca" href="#zoeken"><img src="img/cat-horeca.jpg"><span>Horeca</span></a></li>
                <li><a class="catdot" data-cat="wellness" href="#zoeken"><img src="img/cat-wellness.jpg"><span>Wellness</span></a></li>
                <li><a class="catdot" data-cat="zorg" href="#zoeken"><img src="img/cat-gezondheid.jpg"><span>Gezondheid</span></a></li>
                <li><a class="catdot" data-cat="events" href="#zoeken"><img src="img/cat-events.jpg"><span>Events</span></a></li>
                <li><a class="catdot" data-cat="huishoudhulp" href="#zoeken"><img src="img/cat-huishoudhulp.jpg"><span>Huishoudhulp</span></a></li>
                <li><a class="catdot" data-cat="ramenwasser" href="#zoeken"><img src="img/cat-ramenwasser.jpg"><span>Ramenwasser</span></a></li>
                <li><a class="catdot" data-cat="dieren" href="#zoeken"><img src="img/cat-dieren.jpg"><span>Dieren</span></a></li>
                <li><a class="catdot" data-cat="bouw" href="#zoeken"><img src="img/cat-bouw.jpg"><span>Bouw & renovatie</span></a></li>
              </ul>
            </section>

            <!-- Zoekformulier -->
            <section class="search-wrap" id="zoeken">
              <form class="search" id="form">
                <div class="field">
                  <label for="q">Wat zoek je?</label>
                  <input id="q" name="q" type="text" placeholder="Bedrijf, trefwoord…">
                </div>
                <div class="field">
                  <label for="loc">Waar?</label>
                  <input id="loc" name="loc" type="text" placeholder="Stad, regio…">
                </div>
                <div class="field">
                  <label for="from">Vanaf</label>
                  <input id="from" name="from" type="date">
                </div>
                <div class="field">
                  <label for="to">Tot</label>
                  <input id="to" name="to" type="date">
                </div>
                <div class="field">
                  <label for="cat">Categorie</label>
                  <select id="cat" name="cat">
                    <option value="">Alle</option>
                    <option value="horeca">Horeca</option>
                    <option value="wellness">Wellness</option>
                    <option value="zorg">Gezondheid</option>
                    <option value="events">Events</option>
                    <option value="huishoudhulp">Huishoudhulp</option>
                    <option value="ramenwasser">Ramenwasser</option>
                    <option value="dieren">Dieren</option>
                    <option value="bouw">Bouw & renovatie</option>
                  </select>
                </div>
                <button type="submit" class="btn-primary search-btn">Zoek</button>
              </form>
            </section>

            <!-- Resultaten -->
            <section class="results" id="results" hidden>
              <div class="results-inner">
                <div class="results-head">
                  <h2 id="results-title">Vrije plekken</h2>
                  <div class="results-meta" id="results-meta">&nbsp;</div>
                </div>

                <div id="booking-msg"></div>
                <div id="results-list" class="results-list"></div>
              </div>
            </section>

          </div>

        </div> <!-- /page-container -->
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="footer-inner">
        <span>© <span id="year"></span> Vrijeplek.be — Last minute afspraken, netjes geregeld.</span>
        <nav class="footer-nav">
          <a href="/voorwaarden.html">Algemene voorwaarden</a>
          <a href="/waarom">Waarom Vrijeplek?</a>
        </nav>
      </div>
    </footer>

  </div> <!-- /site -->

<script src="/js/config.js"></script>
<script src="/js/index-logic.js?v=6"></script>
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  function createSupabaseClient() {
    const SUPABASE_URL =
      window.VRIJEPLEK?.SUPABASE_URL ||
      window.ENV?.SUPABASE_URL || '';
    const SUPABASE_ANON_KEY =
      window.VRIJEPLEK?.SUPABASE_ANON_KEY ||
      window.ENV?.SUPABASE_ANON_KEY || '';

    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
      console.error('Supabase credentials niet geconfigureerd (homepage).');
      return null;
    }

    return createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: {
        persistSession: true,
        autoRefreshToken: true,
        storage: localStorage,
      },
    });
  }

  function initSupabase() {
    return new Promise((resolve) => {
      // Config al geladen?
      if (window.VRIJEPLEK?.SUPABASE_URL && window.VRIJEPLEK?.SUPABASE_ANON_KEY) {
        resolve(createSupabaseClient());
        return;
      }

      // Wachten op event van config.js
      window.addEventListener(
        'vrijeplek-config-loaded',
        () => {
          resolve(createSupabaseClient());
        },
        { once: true },
      );

      // Fallback na 3 seconden
      setTimeout(() => {
        resolve(createSupabaseClient());
      }, 3000);
    });
  }

  const btnLogin = document.getElementById('nav-login');
  const btnMijn  = document.getElementById('nav-mijn');

  function showLogin() {
    if (!btnLogin || !btnMijn) return;
    btnLogin.style.display = 'inline-flex';
    btnLogin.style.visibility = 'visible';

    btnMijn.style.display = 'none';
    btnMijn.style.visibility = 'hidden';
    btnMijn.style.opacity = '0';
    btnMijn.style.pointerEvents = 'none';
  }

  function showMijn() {
    if (!btnLogin || !btnMijn) return;
    btnLogin.style.display = 'none';
    btnLogin.style.visibility = 'hidden';

    btnMijn.style.display = 'inline-flex';
    btnMijn.style.visibility = 'visible';
    btnMijn.style.opacity = '1';
    btnMijn.style.pointerEvents = 'auto';
  }

  (async () => {
    // Start: gewoon "Login" tonen (zoals je HTML)
    showLogin();

    const supa = await initSupabase();
    if (!supa) {
      showLogin();
      return;
    }

    async function updateFromSession() {
      try {
        const { data, error } = await supa.auth.getSession();

        if (error) {
          console.error('Session check error (index):', error);
          showLogin();
          return;
        }

        const session = data?.session || null;
        const hasValidSession = !!(session?.user?.id);
        const expired = session?.expires_at
          ? new Date(session.expires_at * 1000) < new Date()
          : false;

        if (hasValidSession && !expired) {
          // Ingelogd → groene “Mijn Vrijeplek”
          showMijn();
        } else {
          // Niet (meer) ingelogd
          showLogin();
        }
      } catch (err) {
        console.error('Toggle nav error (index):', err);
        showLogin();
      }
    }

    // Eerste check bij laden
    await updateFromSession();

    // Op veranderingen in loginstatus reageren
    supa.auth.onAuthStateChange(() => {
      updateFromSession();
    });
  })();
</script>
<form id="booking-form" class="booking-form">
  <div class="field">
    <label for="bk-name">Naam</label>
    <input id="bk-name" name="name" type="text" required placeholder="Naam en voornaam">
  </div>

  <div class="field">
    <label for="bk-gender">Man / Vrouw</label>
    <select id="bk-gender" name="gender" required>
      <option value="" selected>Kies…</option>
      <option value="man">Man</option>
      <option value="vrouw">Vrouw</option>
      <option value="x">X / anders</option>
      <option value="zeg_ik_liever_niet">Zeg ik liever niet</option>
    </select>
  </div>

  <div class="field">
    <label for="bk-birth-year">Geboortejaar</label>
    <input id="bk-birth-year" name="birth_year" type="number" inputmode="numeric"
           min="1900" max="2025" placeholder="bv. 1992" required>
  </div>

  <div class="field">
    <label for="bk-street">Adres</label>
    <input id="bk-street" name="street" type="text" placeholder="Straat + nummer" required>
  </div>

  <div class="field">
    <label for="bk-zip">Postcode</label>
    <input id="bk-zip" name="zip" type="text" inputmode="numeric" placeholder="bv. 2000" required>
  </div>

  <div class="field">
    <label for="bk-city">Gemeente</label>
    <input id="bk-city" name="city" type="text" placeholder="bv. Antwerpen" required>
  </div>

  <div class="field">
    <label for="bk-email">E-mailadres</label>
    <input id="bk-email" name="email" type="email" required placeholder="jij@example.com">
  </div>

  <div class="field">
    <label for="bk-phone">Telefoon / GSM</label>
    <input id="bk-phone" name="phone" type="tel" required placeholder="GSM-nummer voor bevestiging">
  </div>

  <div class="field">
    <label for="bk-notes">Extra info (optioneel)</label>
    <textarea id="bk-notes" name="notes" rows="2" placeholder="Bv. korte toelichting, voorkeur, ..."></textarea>
  </div>

  <div class="field" style="margin-top:0.5rem;">
    <label style="display:flex; gap:.6rem; align-items:flex-start; font-weight:600;">
      <input type="checkbox" name="terms" id="bk-terms" required style="margin-top:.25rem;">
      <span>
        Ik ga akkoord met de <a href="/voorwaarden.html" target="_blank" rel="noopener">algemene voorwaarden</a>.
      </span>
    </label>
  </div>

  <p class="helper" id="booking-deposit-hint" style="display:none;">
    Voor deze afspraak wordt een voorschot gevraagd.
    Je betaalt veilig online. De zaak bevestigt daarna je boeking.
  </p>

  <div class="form-actions">
    <button type="button" class="btn-ghost" id="booking-cancel-btn">Annuleren</button>
    <button type="submit" class="btn-primary" id="booking-submit-btn">
      Boeking bevestigen
    </button>
  </div>

  <p class="helper" id="booking-error" style="display:none; color:#fecaca;"></p>
</form>
