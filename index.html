<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vrijeplek — Last minute? Zoek een afspraak!</title>

  <!-- Google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --o1:#1a66ff;
      --o2:#0056ff;
      --ink:#0a2a4a;
      --line:rgba(26,102,255,.22);
      --glass:rgba(255,255,255,.9);
      --glass-soft:rgba(255,255,255,.82);
      --danger:#e11d48;
      --ok:#15803d;
    }

    html, body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',system-ui,-apple-system,'Segoe UI',sans-serif;
      color:var(--ink);
      background:
        radial-gradient(120% 140% at 0% 0%, #003b84 0, transparent 60%),
        radial-gradient(120% 140% at 100% 0%, #00a0ff 0, transparent 55%),
        radial-gradient(160% 160% at 50% 120%, #021428 0, #020617 55%);
      background-attachment:fixed;
    }
    .site{
      min-height:100svh;
      display:flex;
      flex-direction:column;
    }

    /* HEADER (glas, zelfde gevoel als dashboard) */
    header.site-header{
      position:sticky;
      top:0;
      z-index:50;
      background:linear-gradient(135deg,rgba(11,15,30,.95),rgba(11,15,30,.7));
      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);
      border-bottom:1px solid rgba(148,163,184,.4);
      box-shadow:0 12px 30px rgba(0,0,0,.4);
    }
    .header-inner{
      max-width:1200px;
      margin:0 auto;
      padding:10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:#e5edff;
    }
    .brand-mark{
      width:32px;
      height:32px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 20%, #fff 0, #b3e0ff 18%, transparent 40%),
        radial-gradient(circle at 80% 80%, #0f5bff 0, #001d5c 55%);
      box-shadow:0 0 0 1px rgba(255,255,255,.1),0 10px 30px rgba(0,0,0,.4);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.1rem;
      font-weight:700;
      color:#fff;
    }
    .brand-wordmark{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .brand-wordmark span:first-child{
      font-weight:700;
      letter-spacing:.02em;
      font-size:1.05rem;
      color:#f9fafb;
    }
    .brand-wordmark span:last-child{
      font-size:.7rem;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:rgba(226,232,240,.8);
    }

    .header-actions{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .nav-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 14px;
      border-radius:999px;
      text-decoration:none;
      font-weight:600;
      border:1px solid rgba(148,163,184,.6);
      color:#e5edff;
      background:rgba(15,23,42,.7);
      font-size:13px;
      transition:background .15s ease, transform .15s ease, box-shadow .15s ease;
      backdrop-filter:blur(10px);
    }
    .nav-btn:hover{
      background:rgba(15,23,42,.95);
      box-shadow:0 10px 26px rgba(15,23,42,.8);
      transform:translateY(-1px);
    }
    .btn-green{
      background:linear-gradient(135deg,#16a34a,#0f766e);
      border-color:rgba(34,197,94,.7);
      color:#eafff2;
      box-shadow:0 12px 30px rgba(22,163,74,.6);
    }
    .btn-green:hover{
      filter:brightness(1.05);
      transform:translateY(-1px);
    }

    main{flex:1;}

    /* LAYOUT: flexijobs mag NIET de rest beïnvloeden */
    .main-grid{
      padding:18px 0 40px;
    }

    /* container waarop we de absolute flexbox baseren */
    .flex-shell{
      position:relative;          /* <– belangrijk voor absolute positionering van flex-panel */
      max-width:1200px;
      margin:0 auto;
      padding:0 12px 40px;
    }

    /* LINKS: flexijobs los, vast op pagina */
    .flex-panel{
      position:absolute;
      left:-160px;                  /* VERPLAATS HIER: meer of minder links */
      top:210px;                  /* VERPLAATS HIER: hoger/lager */
      width:260px;

      background:linear-gradient(135deg,rgba(15,23,42,.96),rgba(15,23,42,.9));
      border-radius:18px;
      padding:14px 14px 16px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 20px 50px rgba(15,23,42,.95);
      color:#e5e7eb;
    }
    .flex-title{
      margin:0 0 4px;
      font-size:15px;
      font-weight:700;
      color:#e5edff;
    }
    .flex-sub{
      margin:0 0 10px;
      font-size:12px;
      color:rgba(191,219,254,.9);
    }
    .flex-field{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:8px;
    }
    .flex-field label{
      font-size:11px;
      font-weight:600;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:rgba(226,232,240,.9);
    }
    .flex-field input,
    .flex-field select{
      padding:7px 9px;
      border-radius:9px;
      border:1px solid rgba(148,163,184,.75);
      font-size:12px;
      font-family:inherit;
      background:rgba(15,23,42,.95);
      color:#e5edff;
      outline:none;
    }
    .flex-field input::placeholder{
      color:rgba(148,163,184,.9);
    }
    .flex-field input:focus,
    .flex-field select:focus{
      border-color:rgba(59,130,246,.95);
      box-shadow:0 0 0 1px rgba(59,130,246,.7);
      background:rgba(15,23,42,.98);
    }
    .btn-primary-small{
      padding:7px 12px;
      font-size:12px;
      box-shadow:0 10px 26px rgba(37,99,235,.6);
    }
    .flex-status{
      margin-top:8px;
      font-size:11px;
      color:rgba(191,219,254,.9);
      min-height:14px;
    }
    .flex-list{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height:420px;
      overflow:auto;
      padding-right:4px;
    }
    .flex-job-card{
      border-radius:12px;
      padding:8px 8px;
      background:rgba(15,23,42,.98);
      border:1px solid rgba(148,163,184,.7);
      display:grid;
      grid-template-columns:52px minmax(0,1fr);
      gap:8px;
      font-size:12px;
    }
    .flex-job-thumb{
      width:52px;
      height:52px;
      border-radius:11px;
      overflow:hidden;
      background:radial-gradient(circle at 0 0,rgba(59,130,246,.45),rgba(15,23,42,1));
      border:1px solid rgba(148,163,184,.7);
      flex-shrink:0;
    }
    .flex-job-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .flex-job-main{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .flex-job-name{
      font-size:12px;
      font-weight:600;
      color:#e5edff;
      margin:0;
    }
    .flex-job-role{
      font-size:11px;
      color:rgba(191,219,254,.95);
    }
    .flex-job-loc{
      font-size:11px;
      color:rgba(148,163,184,.95);
    }
    .flex-job-actions{
      margin-top:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      font-size:11px;
    }
    .flex-badge{
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(129,140,248,.75);
      background:rgba(15,23,42,.95);
      color:#e0f2fe;
      font-size:10px;
      white-space:nowrap;
    }
    .flex-view-btn{
      border-radius:999px;
      border:0;
      padding:4px 9px;
      font-size:11px;
      font-weight:600;
      background:linear-gradient(135deg,var(--o1),var(--o2));
      color:#fff;
      cursor:pointer;
      box-shadow:0 4px 12px rgba(37,99,235,.7);
      white-space:nowrap;
    }

    /* MIDDEN: zoekspul gewoon gecentreerd (flex-panel beïnvloedt dit NIET) */
    .search-column-wrap{
      display:flex;
      justify-content:center;
    }
    .search-column{
      width:100%;
      max-width:860px;
      min-width:0;
      margin:0 auto;
    }

    /* CATEGORIE BOLLEN (in middenkolom) */
    .cat-dots{
      padding:0 0 4px;
      margin-bottom:8px;
    }
    .cat-dots-row{
      display:flex;
      flex-wrap:wrap;
      gap:14px;
      list-style:none;
      padding:0;
      margin:0;
      justify-content:center;
    }
    .catdot{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      text-decoration:none;
      color:#f9fafb;
    }
    .catdot img{
      width:82px;
      height:82px;
      object-fit:cover;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 14px 40px rgba(15,23,42,.9);
      background:#020617;
    }
    .catdot span{
      font-weight:600;
      font-size:13px;
      color:#e5edff;
      text-shadow:0 1px 3px rgba(0,0,0,.7);
    }

    /* ZOEKKAART */
    .search-wrap{
      width:100%;
      margin:6px 0 20px;
      padding:18px 18px 16px;
      border-radius:20px;
      background:radial-gradient(circle at 0 0,rgba(59,130,246,.35),transparent 60%),
                 radial-gradient(circle at 100% 0,rgba(56,189,248,.32),transparent 50%),
                 rgba(15,23,42,.88);
      box-shadow:0 22px 60px rgba(15,23,42,.9);
      border:1px solid rgba(191,219,254,.35);
      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);
    }
    form.search{
      display:grid;
      grid-template-columns:1.2fr 1fr .8fr .8fr 1fr auto;
      gap:12px;
      align-items:flex-end;
    }
    @media(max-width:1024px){
      form.search{grid-template-columns:1fr 1fr 1fr;}
    }
    @media(max-width:720px){
      form.search{grid-template-columns:1fr;}
    }
    .search .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      text-align:left;
    }
    .search label{
      font-size:11px;
      font-weight:700;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:rgba(226,232,240,.9);
    }
    .search input,
    .search select{
      padding:9px 10px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.75);
      font-size:13px;
      font-family:inherit;
      background:rgba(15,23,42,.95);
      color:#e5edff;
      outline:none;
      transition:border-color .15s, box-shadow .15s, background .15s;
    }
    .search input::placeholder{
      color:rgba(148,163,184,.9);
    }
    .search input:focus,
    .search select:focus{
      border-color:rgba(59,130,246,.95);
      box-shadow:0 0 0 1px rgba(59,130,246,.7);
      background:rgba(15,23,42,.98);
    }
    .btn-primary{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:11px 18px;
      border-radius:999px;
      border:none;
      background:linear-gradient(120deg,var(--o1),var(--o2));
      color:#f9fafb;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 14px 36px rgba(37,99,235,.6);
      transform:translateY(1px);
      transition:.16s ease;
      white-space:nowrap;
    }
    .btn-primary:hover{
      transform:translateY(0);
      filter:brightness(1.05);
    }

    /* RESULTATEN */
    .results{
      padding:4px 0 0;
    }
    .results-inner{
      margin:0;
      padding:0;
    }
    .results-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:16px;
    }
    .results-head h2{
      margin:0;
      font-size:20px;
      font-weight:700;
      color:#e5edff;
      text-shadow:0 1px 3px rgba(0,0,0,.7);
    }
    .results-meta{
      font-size:13px;
      color:rgba(191,219,254,.9);
    }
    .results-list{
      display:flex;
      flex-direction:column;
      gap:20px;
    }
    .category-group h3{
      margin:0 0 8px;
      font-size:15px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:rgba(191,219,254,.9);
    }
    .category-group .cards{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .result-card{
      display:grid;
      grid-template-columns:120px minmax(0,1fr);
      gap:14px;
      padding:12px 14px;
      border-radius:16px;
      background:linear-gradient(135deg,rgba(15,23,42,.96),rgba(15,23,42,.9));
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 18px 45px rgba(15,23,42,.9);
      color:#e5e7eb;
    }
    @media(max-width:700px){
      .result-card{
        grid-template-columns:minmax(0,1fr);
      }
    }
    .result-thumb{
      position:relative;
      border-radius:12px;
      overflow:hidden;
      background:radial-gradient(circle at 0 0,rgba(59,130,246,.45),rgba(15,23,42,1));
      border:1px solid rgba(148,163,184,.7);
    }
    .result-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .thumb-tag{
      position:absolute;
      inset:auto 8px 8px 8px;
      padding:4px 7px;
      border-radius:999px;
      font-size:10px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,163,184,.7);
      display:inline-flex;
      align-items:center;
      gap:5px;
    }
    .thumb-dot{
      width:6px;
      height:6px;
      border-radius:999px;
      background:radial-gradient(circle,#22c55e,#15803d);
      box-shadow:0 0 0 3px rgba(34,197,94,.3);
    }

    .result-main{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .result-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
    }
    .result-title{
      font-size:16px;
      margin:0;
      font-weight:700;
      color:#f9fafb;
    }
    .result-cat{
      font-size:11px;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(129,140,248,.8);
      background:rgba(15,23,42,.9);
      color:#e5edff;
      white-space:nowrap;
    }
    .result-body{
      font-size:13px;
      color:rgba(226,232,240,.9);
    }
    .result-body .line{
      margin:1px 0;
    }
    .rating-line{
      display:flex;
      align-items:center;
      gap:6px;
      margin-top:4px;
      font-size:12px;
      color:rgba(250,250,250,.9);
    }
    .rating-stars{
      font-size:13px;
    }
    .biz-actions{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .biz-link{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(191,219,254,.9);
      font-size:11px;
      text-decoration:none;
      color:#e0f2fe;
      background:rgba(15,23,42,.9);
    }
    .biz-link:hover{
      background:rgba(30,64,175,.95);
    }
    .deposit-chip{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(15,118,110,.2);
      border:1px solid rgba(34,197,94,.7);
      color:#bbf7d0;
    }
    .deposit-chip.off{
      background:rgba(15,23,42,.4);
      border-color:rgba(148,163,184,.8);
      color:rgba(209,213,219,.9);
    }

    .slots-list{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:8px;
      padding:0;
      list-style:none;
      font-size:12px;
    }
    .slot-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 9px;
      border-radius:999px;
      background:rgba(15,23,42,.96);
      border:1px solid rgba(148,163,184,.8);
      box-shadow:0 4px 12px rgba(15,23,42,.9);
      white-space:nowrap;
    }
    .slot-pill.volzet{
      opacity:.55;
    }
    .slot-pill .date{
      font-weight:600;
    }
    .slot-pill .time{
      font-size:11px;
      color:#cbd5f5;
    }
    .slot-book-btn{
      border:0;
      border-radius:999px;
      padding:4px 9px;
      font-size:11px;
      font-weight:600;
      background:linear-gradient(135deg,var(--o1),var(--o2));
      color:#fff;
      cursor:pointer;
      box-shadow:0 4px 10px rgba(37,99,235,.7);
    }

    /* BOOKING STATUS */
    #booking-msg{
      min-height:18px;
      font-size:13px;
    }

    /* FOOTER in dashboard-stijl */
    .site-footer{
      border-top:1px solid rgba(15,23,42,.9);
      background:
        radial-gradient(circle at 50% -60%,rgba(59,130,246,.35),transparent 65%),
        rgba(2,6,23,.96);
    }
    .footer-inner{
      max-width:1200px;
      margin:0 auto;
      padding:14px 12px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:rgba(148,163,184,.9);
      flex-wrap:wrap;
    }
    .footer-nav{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .footer-nav a{
      color:rgba(191,219,254,.95);
      text-decoration:none;
      font-size:12px;
    }
    .footer-nav a:hover{text-decoration:underline;}

    /* MOBIEL: flexijobs onder de zoekbalk, niet absolute */
    @media(max-width:900px){
      .flex-panel{
        position:static;
        width:100%;
        max-width:350px;
        margin:18px auto 0;
      }
    }

    @media(max-width:640px){
      .header-inner{
        padding:10px 12px;
      }
      .results-head{
        flex-direction:column;
        align-items:flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="site">
    <header class="site-header">
      <div class="header-inner">
        <a class="brand" href="/" aria-label="Vrijeplek home">
          <div class="brand-mark">V</div>
          <div class="brand-wordmark">
            <span>vrijeplek</span>
            <span>last minute afspreken</span>
          </div>
        </a>
        <nav class="header-actions">
          <a class="nav-btn" href="/waarom">Waarom Vrijeplek?</a>
          <a class="nav-btn" href="/aanmelden">Word lid</a>
          <a class="nav-btn" href="/login" id="nav-login">Login</a>
          <a class="nav-btn btn-green" href="/dashboard" id="nav-mijn" style="display:none;">Mijn Vrijeplek</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="main-grid">
        <div class="flex-shell">
          <!-- LINKS: flexijobs-paneel, nu echt los -->
          <aside class="flex-panel" aria-label="Flexijobs" id="flex-panel">
            <h2 class="flex-title">Flexijobs in jouw buurt</h2>
            <p class="flex-sub">
              Werk je graag bij als flexi? Bekijk welke zaken nu iemand zoeken.
            </p>

            <div class="flex-field">
              <label for="flex-loc">Waar?</label>
              <input id="flex-loc" type="text" placeholder="Stad, regio…">
            </div>
            <div class="flex-field">
              <label for="flex-cat">Sector</label>
              <select id="flex-cat">
                <option value="">Alle sectoren</option>
                <option value="horeca">Horeca</option>
                <option value="wellness">Wellness</option>
                <option value="zorg">Gezondheid</option>
                <option value="events">Events</option>
                <option value="huishoudhulp">Huishoudhulp</option>
                <option value="ramenwasser">Ramenwasser</option>
                <option value="dieren">Dieren</option>
                <option value="bouw">Bouw &amp; renovatie</option>
              </select>
            </div>

            <button type="button" class="btn-primary btn-primary-small" id="flex-search-btn">
              Zoek flexijobs
            </button>
            <div id="flex-status" class="flex-status"></div>
            <div id="flex-list" class="flex-list"></div>
          </aside>

          <!-- MIDDEN: categorie-bollen + zoek + resultaten -->
          <div class="search-column-wrap">
            <div class="search-column">
              <!-- Categorie knoppen -->
              <section class="cat-dots">
                <ul class="cat-dots-row">
                  <li><a class="catdot" data-cat="horeca" href="#zoeken" title="Horeca"><img src="img/cat-horeca.jpg" alt="Horeca"><span>Horeca</span></a></li>
                  <li><a class="catdot" data-cat="wellness" href="#zoeken" title="Wellness"><img src="img/cat-wellness.jpg" alt="Wellness"><span>Wellness</span></a></li>
                  <li><a class="catdot" data-cat="zorg" href="#zoeken" title="Gezondheid"><img src="img/cat-gezondheid.jpg" alt="Gezondheid"><span>Gezondheid</span></a></li>
                  <li><a class="catdot" data-cat="events" href="#zoeken" title="Events"><img src="img/cat-events.jpg" alt="Events"><span>Events</span></a></li>
                  <li><a class="catdot" data-cat="huishoudhulp" href="#zoeken" title="Huishoudhulp"><img src="img/cat-huishoudhulp.jpg" alt="Huishoudhulp"><span>Huishoudhulp</span></a></li>
                  <li><a class="catdot" data-cat="ramenwasser" href="#zoeken" title="Ramenwasser"><img src="img/cat-ramenwasser.jpg" alt="Ramenwasser"><span>Ramenwasser</span></a></li>
                  <li><a class="catdot" data-cat="dieren" href="#zoeken" title="Dieren"><img src="img/cat-dieren.jpg" alt="Dieren"><span>Dieren</span></a></li>
                  <li><a class="catdot" data-cat="bouw" href="#zoeken" title="Bouw & renovatie"><img src="img/cat-bouw.jpg" alt="Bouw & renovatie"><span>Bouw &amp; renovatie</span></a></li>
                </ul>
              </section>

              <!-- Zoekformulier -->
              <section class="search-wrap" id="zoeken">
                <form class="search" id="form">
                  <div class="field">
                    <label for="q">Wat zoek je?</label>
                    <input id="q" name="q" type="text" placeholder="Bedrijf, trefwoord…">
                  </div>
                  <div class="field">
                    <label for="loc">Waar?</label>
                    <input id="loc" name="loc" type="text" placeholder="Stad, regio…">
                  </div>
                  <div class="field">
                    <label for="from">Vanaf</label>
                    <input id="from" name="from" type="date">
                  </div>
                  <div class="field">
                    <label for="to">Tot</label>
                    <input id="to" name="to" type="date">
                  </div>
                  <div class="field">
                    <label for="cat">Categorie</label>
                    <select id="cat" name="cat">
                      <option value="">Alle</option>
                      <option value="horeca">Horeca</option>
                      <option value="wellness">Wellness</option>
                      <option value="zorg">Gezondheid</option>
                      <option value="events">Events</option>
                      <option value="huishoudhulp">Huishoudhulp</option>
                      <option value="ramenwasser">Ramenwasser</option>
                      <option value="dieren">Dieren</option>
                      <option value="bouw">Bouw &amp; renovatie</option>
                    </select>
                  </div>
                  <div class="field" style="align-self:end;">
                    <button type="submit" class="btn-primary">Zoek</button>
                  </div>
                </form>
              </section>

              <!-- Resultaten -->
              <section class="results" id="results" hidden>
                <div class="results-inner">
                  <div class="results-head">
                    <h2 id="results-title">Vrije plekken</h2>
                    <div class="results-meta" id="results-meta">&nbsp;</div>
                  </div>
                  <div id="booking-msg"></div>
                  <div id="results-list" class="results-list"></div>
                </div>
              </section>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <span>© <span id="year"></span> Vrijeplek.be — Last minute afspraken, netjes geregeld.</span>
        <nav class="footer-nav">
          <a href="/voorwaarden.html">Algemene voorwaarden</a>
          <a href="/waarom">Waarom Vrijeplek?</a>
        </nav>
      </div>
    </footer>
  </div>

  <!-- Config + Supabase client voor sessie & nav-knoppen -->
  <script src="/js/config.js"></script>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    function createSupabaseClient(){
      const SUPABASE_URL =
        window.VRIJEPLEK?.SUPABASE_URL ||
        window.ENV?.SUPABASE_URL ||
        '';
      const SUPABASE_ANON_KEY =
        window.VRIJEPLEK?.SUPABASE_ANON_KEY ||
        window.ENV?.SUPABASE_ANON_KEY ||
        '';

      if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
        console.error('Supabase credentials ontbreken op indexpagina.');
        return null;
      }
      return createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
        auth: { persistSession: true, autoRefreshToken: true, storage: localStorage }
      });
    }

    async function initSupabase() {
      return new Promise((resolve) => {
        if (window.VRIJEPLEK?.SUPABASE_URL && window.VRIJEPLEK?.SUPABASE_ANON_KEY) {
          resolve(createSupabaseClient());
          return;
        }
        window.addEventListener('vrijeplek-config-loaded', () => {
          resolve(createSupabaseClient());
        }, { once: true });
        setTimeout(() => {
          resolve(createSupabaseClient());
        }, 3000);
      });
    }

    const supaPromise = initSupabase();

    supaPromise.then(async (supa) => {
      if (!supa) return;
      // beschikbaar maken voor de niet-module script
      window.supabase = supa;

      const btnLogin = document.getElementById('nav-login');
      const btnMijn  = document.getElementById('nav-mijn');

      if (!btnLogin || !btnMijn) return;

      async function toggleNav(){
        try{
          const { data, error } = await supa.auth.getSession();
          if (error){
            console.error('Session check error:', error);
            btnLogin.style.display = 'inline-flex';
            btnMijn.style.display  = 'none';
            return;
          }
          const session = data?.session || null;
          const hasValid = !!(session?.user?.id);
          const expired = session?.expires_at
            ? (new Date(session.expires_at * 1000) < new Date())
            : false;
          const loggedIn = hasValid && !expired;

          if (loggedIn){
            btnLogin.style.display = 'none';
            btnMijn.style.display  = 'inline-flex';
          } else {
            btnLogin.style.display = 'inline-flex';
            btnMijn.style.display  = 'none';
          }
        }catch(err){
          console.error('toggleNav error:', err);
          btnLogin.style.display = 'inline-flex';
          btnMijn.style.display  = 'none';
        }
      }

      await toggleNav();
      supa.auth.onAuthStateChange(() => toggleNav());
    }).catch(err => {
      console.error('Supabase init op index mislukt:', err);
    });
  </script>

  <!-- Zoek + resultaten + boeken + flexijobs -->
  <script>
    // Jaar in footer
    document.getElementById('year').textContent = new Date().getFullYear();

    const form    = document.getElementById('form');
    const qEl     = document.getElementById('q');
    const locEl   = document.getElementById('loc');
    const fromEl  = document.getElementById('from');
    const toEl    = document.getElementById('to');
    const catEl   = document.getElementById('cat');

    const resultsSection = document.getElementById('results');
    const resultsList    = document.getElementById('results-list');
    const resultsTitle   = document.getElementById('results-title');
    const resultsMeta    = document.getElementById('results-meta');
    const bookingMsg     = document.getElementById('booking-msg');

    function escapeHtml(str){
      return (str || '').toString().replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));
    }

    function formatDateNL(iso){
      try{
        return new Date(iso+'T00:00:00').toLocaleDateString('nl-BE', {
          weekday:'short', day:'2-digit', month:'short'
        });
      }catch{
        return iso;
      }
    }

    // categoriebol kliks → filter invullen
    document.querySelectorAll('.catdot').forEach(el=>{
      el.addEventListener('click', (e)=>{
        e.preventDefault();
        const cat = el.dataset.cat || '';
        if (catEl) catEl.value = cat;
        document.getElementById('zoeken').scrollIntoView({behavior:'smooth'});
      });
    });

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const q    = qEl.value.trim();
      const loc  = locEl.value.trim();
      const from = fromEl.value || '';
      const to   = toEl.value || '';
      const cat  = catEl.value || '';

      resultsSection.hidden = false;
      resultsTitle.textContent = 'Vrije plekken';
      resultsMeta.textContent  = 'Zoeken…';
      bookingMsg.textContent   = '';
      resultsList.innerHTML    = '';

      try{
        const r = await fetch('/.netlify/functions/search', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ q, loc, from, to, cat })
        });
        const data = await r.json().catch(()=>[]);
        if (!Array.isArray(data) || !data.length){
          resultsMeta.textContent = 'Geen vrije plekken gevonden met deze filters.';
          resultsList.innerHTML = '';
          return;
        }

        const groups = {};
        data.forEach(item => {
          const catKey = item.cat || 'Onbekend';
          if (!groups[catKey]) groups[catKey] = [];
          groups[catKey].push(item);
        });

        resultsMeta.textContent = `${data.length} zaak/zaak(-en) met vrije momenten gevonden`;
        resultsList.innerHTML = '';

        Object.keys(groups).sort().forEach(catName => {
          const section = document.createElement('div');
          section.className = 'category-group';
          section.innerHTML = `<h3>${escapeHtml(catName)}</h3>`;
          const cardsContainer = document.createElement('div');
          cardsContainer.className = 'cards';

          groups[catName].forEach(item => {
            const card = document.createElement('article');
            card.className = 'result-card';

            const title     = escapeHtml(item.zaak || item.email || 'Onbekend');
            const catLabel  = item.cat ? escapeHtml(item.cat) : 'Onbekend';
            const addrParts = [];
            if (item.straat)   addrParts.push(escapeHtml(item.straat));
            if (item.postcode) addrParts.push(escapeHtml(item.postcode));
            const addr = addrParts.join(' • ');
            const bio  = item.bio ? escapeHtml(item.bio) : '';

            const depositEnabled = !!item.deposit_enabled && Number(item.deposit_amount) > 0;
            const depositAmount  = depositEnabled ? Number(item.deposit_amount) : 0;
            const depositLabel   = depositEnabled
              ? `Voorschot €${depositAmount.toFixed(0)}`
              : 'Geen voorschot';

            const photoUrl =
              item.photo_url ||
              item.photo ||
              `https://source.unsplash.com/600x400/?${encodeURIComponent(item.cat || 'business')}`;

            const rating  = typeof item.google_rating === 'number' ? item.google_rating : null;
            const reviews = typeof item.google_reviews === 'number' ? item.google_reviews : null;

            const primaryUrl = item.site_id
              ? `/site.html?id=${encodeURIComponent(item.site_id)}`
              : (item.website || '');

            const thumb = document.createElement('div');
            thumb.className = 'result-thumb';
            thumb.innerHTML = `
              <img src="${escapeHtml(photoUrl)}" alt="">
              <div class="thumb-tag"><span class="thumb-dot"></span><span>Nu beschikbaar</span></div>
            `;

            const main = document.createElement('div');
            main.className = 'result-main';

            const head = document.createElement('div');
            head.className = 'result-head';
            head.innerHTML = `
              <h3 class="result-title">${title}</h3>
              <span class="result-cat">${catLabel}</span>
            `;

            const body = document.createElement('div');
            body.className = 'result-body';
            body.innerHTML = `
              ${addr ? `<div class="line">${addr}</div>` : ``}
              ${bio ? `<div class="line">${bio}</div>` : ``}
            `;

            if (rating !== null){
              const ratingLine = document.createElement('div');
              ratingLine.className = 'rating-line';
              ratingLine.innerHTML =
                `<span class="rating-stars">★ ${rating.toFixed(1)}</span>` +
                (reviews ? `<span>${reviews} Google-reviews</span>` : '');
              body.appendChild(ratingLine);
            }

            const actions = document.createElement('div');
            actions.className = 'biz-actions';

            const depSpan = document.createElement('span');
            depSpan.className = 'deposit-chip ' + (depositEnabled ? '' : 'off');
            depSpan.textContent = depositLabel;
            actions.appendChild(depSpan);

            if (primaryUrl){
              const link = document.createElement('a');
              link.className = 'biz-link';
              link.href = primaryUrl;
              link.target = '_blank';
              link.rel = 'noopener';
              link.textContent = 'Bekijk pagina';
              actions.appendChild(link);
            }

            body.appendChild(actions);

            const ul = document.createElement('ul');
            ul.className = 'slots-list';
            const slots = (item.slots || []).slice(0,12);

            if (!slots.length){
              ul.innerHTML = `<li class="slot-pill"><span class="time">Geen vrije momenten in deze periode.</span></li>`;
            } else {
              slots.forEach(s => {
                const li = document.createElement('li');
                li.className = 'slot-pill';
                li.dataset.slotId = s.id;
                li.dataset.depositEnabled = depositEnabled ? '1' : '0';
                li.dataset.depositAmount  = depositAmount ? String(depositAmount) : '0';

                const dateSpan = document.createElement('span');
                dateSpan.className = 'date';
                dateSpan.textContent = formatDateNL(s.date);

                const timeSpan = document.createElement('span');
                timeSpan.className = 'time';
                timeSpan.textContent = `${s.from || ''} – ${s.to || ''}`;

                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'slot-book-btn';
                btn.textContent = 'Boek nu';
                btn.dataset.slotId = s.id;
                btn.dataset.depositEnabled = depositEnabled ? '1' : '0';
                btn.dataset.depositAmount  = depositAmount ? String(depositAmount) : '0';

                li.appendChild(dateSpan);
                li.appendChild(timeSpan);
                li.appendChild(btn);
                ul.appendChild(li);
              });
            }

            main.appendChild(head);
            main.appendChild(body);
            main.appendChild(ul);

            card.appendChild(thumb);
            card.appendChild(main);
            cardsContainer.appendChild(card);
          });

          section.appendChild(cardsContainer);
          resultsList.appendChild(section);
        });
      }catch(err){
        console.error(err);
        resultsMeta.textContent = 'Zoeken mislukt (server).';
        resultsList.innerHTML = '';
      }
    });

    // Boeken
    async function handleBook(btn){
      const pill = btn.closest('.slot-pill');
      if (!pill || pill.classList.contains('volzet')) return;
      const slotId = btn.dataset.slotId;
      if (!slotId) return;

      const depositEnabled = btn.dataset.depositEnabled === '1';
      const depositAmount  = Number(btn.dataset.depositAmount || '0');

      bookingMsg.style.color = depositEnabled ? 'var(--ok)' : 'var(--ok)';
      bookingMsg.textContent = depositEnabled
        ? `We bereiden je voorschotbetaling van €${depositAmount.toFixed(0)} voor…`
        : 'Je boeking wordt aangemaakt…';

      btn.disabled = true;

      try{
        let customerEmail = '';
        let customerName  = '';

        try{
          if (window.supabase){
            const { data } = await window.supabase.auth.getSession();
            const session = data?.session;
            if (session?.user){
              customerEmail = session.user.email || '';
              customerName  = session.user.user_metadata?.full_name ||
                              session.user.user_metadata?.name ||
                              '';
            }
          }
        }catch{}

        if (!customerEmail){
          customerEmail = prompt('Voer je e-mailadres in voor de boeking:');
          if (!customerEmail || !customerEmail.trim()){
            bookingMsg.style.color = 'var(--danger)';
            bookingMsg.textContent = 'E-mailadres is verplicht voor boeking.';
            btn.disabled = false;
            return;
          }
        }

        const res = await fetch('/.netlify/functions/create-deposit', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({
            slotId: slotId,
            customer_email: customerEmail.trim().toLowerCase(),
            customer_name: (customerName || '').trim()
          })
        });
        const data = await res.json().catch(()=>null);

        if (!res.ok || !data){
          bookingMsg.style.color = 'var(--danger)';
          bookingMsg.textContent = 'Boeking mislukt (server).';
          btn.disabled = false;
          return;
        }
        if (data.error){
          bookingMsg.style.color = 'var(--danger)';
          bookingMsg.textContent = data.error;
          btn.disabled = false;
          return;
        }
        if (data.url){
          bookingMsg.style.color = 'var(--ok)';
          bookingMsg.textContent = 'Je wordt doorgestuurd naar de betaalpagina…';
          window.location.href = data.url;
          return;
        }
        if (data.ok){
          bookingMsg.style.color = 'var(--ok)';
          bookingMsg.textContent = 'Tijdslot geboekt. Je ontvangt een bevestiging.';
          pill.classList.add('volzet');
          btn.textContent = 'Volzet';
          return;
        }
      }catch(err){
        console.error(err);
        bookingMsg.style.color = 'var(--danger)';
        bookingMsg.textContent = 'Boeking mislukt (client).';
      }finally{
        btn.disabled = false;
      }
    }

    resultsList.addEventListener('click', (e)=>{
      const btn = e.target.closest('.slot-book-btn');
      if (btn) handleBook(btn);
    });

    /* FLEXIJOBS LOGICA */
    const flexLocEl    = document.getElementById('flex-loc');
    const flexCatEl    = document.getElementById('flex-cat');
    const flexListEl   = document.getElementById('flex-list');
    const flexStatusEl = document.getElementById('flex-status');
    const flexSearchBtn= document.getElementById('flex-search-btn');

    async function loadFlexJobs(){
      if (!flexListEl || !flexStatusEl) return;

      const loc = (flexLocEl?.value || '').trim();
      const cat = (flexCatEl?.value || '').trim();

      flexStatusEl.textContent = 'Zoeken…';
      flexListEl.innerHTML = '';

      try{
        const params = new URLSearchParams();
        if (loc) params.set('loc', loc);
        if (cat) params.set('cat', cat);
        const url = '/.netlify/functions/flexijobs' + (params.toString() ? `?${params.toString()}` : '');

        const res = await fetch(url, { method:'GET' });
        const data = await res.json().catch(()=>[]);

        if (!Array.isArray(data) || !data.length){
          flexStatusEl.textContent = 'Geen flexijobs gevonden met deze filters.';
          flexListEl.innerHTML = '';
          return;
        }

        flexStatusEl.textContent = `${data.length} flexijob(s) gevonden`;
        flexListEl.innerHTML = '';

        data.forEach(job => {
          const card = document.createElement('article');
          card.className = 'flex-job-card';

          const photoUrl =
            job.photo_url ||
            job.business_photo ||
            `https://source.unsplash.com/200x200/?${encodeURIComponent(job.sector || 'job')}`;

          const naam  = escapeHtml(job.business_name || job.company || 'Onbekende zaak');
          const role  = escapeHtml(job.title || job.role || 'Flexijob');
          const city  = escapeHtml(job.city || '');
          const pc    = escapeHtml(job.postcode || job.postal || '');
          const locTxt= (pc || city) ? `${pc} ${city}`.trim() : '';

          const thumb = document.createElement('div');
          thumb.className = 'flex-job-thumb';
          thumb.innerHTML = `<img src="${photoUrl}" alt="">`;

          const main = document.createElement('div');
          main.className = 'flex-job-main';

          const nameEl = document.createElement('p');
          nameEl.className = 'flex-job-name';
          nameEl.textContent = naam;

          const roleEl = document.createElement('div');
          roleEl.className = 'flex-job-role';
          roleEl.textContent = role;

          const locEl = document.createElement('div');
          locEl.className = 'flex-job-loc';
          locEl.textContent = locTxt;

          const actions = document.createElement('div');
          actions.className = 'flex-job-actions';

          const sectorLabel = job.sector || job.cat || '';
          if (sectorLabel){
            const badge = document.createElement('span');
            badge.className = 'flex-badge';
            badge.textContent = sectorLabel;
            actions.appendChild(badge);
          }

          const viewBtn = document.createElement('button');
          viewBtn.type = 'button';
          viewBtn.className = 'flex-view-btn';
          viewBtn.textContent = 'Bekijk vacature';
          viewBtn.addEventListener('click', () => {
            window.location.href = '/flexijob.html?id=' + encodeURIComponent(job.id);
          });

          actions.appendChild(viewBtn);

          main.appendChild(nameEl);
          if (role) main.appendChild(roleEl);
          if (locTxt) main.appendChild(locEl);
          main.appendChild(actions);

          card.appendChild(thumb);
          card.appendChild(main);
          flexListEl.appendChild(card);
        });
      }catch(err){
        console.error(err);
        flexStatusEl.textContent = 'Flexijobs laden mislukt.';
        flexListEl.innerHTML = '';
      }
    }

    if (flexSearchBtn){
      flexSearchBtn.addEventListener('click', loadFlexJobs);
      // eerste load zonder filters
      loadFlexJobs();
    }
  </script>
</body>
</html>

